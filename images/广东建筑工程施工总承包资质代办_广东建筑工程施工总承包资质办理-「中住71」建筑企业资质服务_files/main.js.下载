(function (define, require) {


define("front/webimlite/im/font",["require","../base/dom","../base/browser","../base/event","qiao-im-core"],function(require){var e=require("../base/dom"),t=require("../base/browser"),n=require("../base/event"),i=require("qiao-im-core"),r=i.lib.mixin,a=(e.g,n.on),o=["宋体","楷体_GB2312","黑体","隶书","Times New Roman","Arial"],s=[{text:"8",value:"8pt"},{text:"9",value:"9pt"},{text:"10",value:"10pt"},{text:"11",value:"11pt"},{text:"12",value:"12pt"},{text:"14",value:"14pt"},{text:"16",value:"16pt"},{text:"18",value:"18pt"},{text:"20",value:"20pt"},{text:"22",value:"22pt"},{text:"24",value:"24pt"},{text:"26",value:"26pt"},{text:"28",value:"28pt"},{text:"36",value:"36pt"},{text:"48",value:"48pt"},{text:"72",value:"72pt"}],u='<table border="0" cellspacing="0" cellpadding="0"><tr><td><a href="#"><span style="background-color:#990000"></span></a></td><td><a href="#"><span style="background-color:#ff0000"></span></a></td><td><a href="#"><span style="background-color:#ff9900"></span></a></td><td><a href="#"><span style="background-color:#ffffff"></span></a></td></tr><tr><td><a href="#"><span style="background-color:#ffff00"></span></a></td><td><a href="#"><span style="background-color:#99ff99"></span></a></td><td><a href="#"><span style="background-color:#006600"></span></a></td><td><a href="#"><span style="background-color:#666666"></span></a></td></tr><tr><td><a href="#"><span style="background-color:#99ccff"></span></a></td><td><a href="#"><span style="background-color:#000099"></span></a></td><td><a href="#"><span style="background-color:#990066"></span></a></td><td><a href="#"><span style="background-color:#000000"></span></a></td></tr></table>',l={wrap:null,_b:!1,_i:!1,_u:!1,view:{}},exports={};r(exports);var c={init:function(t){var n=document.createDocumentFragment(),i=l.view;e.addClass(t,"BD-QIAO-IM-FONT-WRAP"),i.family=c.createSelect("m-font-family-select",o),n.appendChild(i.family),i.fontSize=c.createSelect("m-font-size-select",s,"9pt"),n.appendChild(i.fontSize),i.bold=e.create("a",{className:"m-font-bold m-font-btn",title:"加粗"}),i.italic=e.create("a",{className:"m-font-italic m-font-btn",title:"斜体"}),i.underline=e.create("a",{className:"m-font-underline m-font-btn",title:"下划线"}),i.fontColor=e.create("a",{className:"m-font-color m-font-btn",title:"字体颜色"}),i.palette=e.create("div",{className:"m-font-palette"}),i.palette.style.display="none",i.palette.innerHTML=u,n.appendChild(i.bold),n.appendChild(i.italic),n.appendChild(i.underline),n.appendChild(i.fontColor),n.appendChild(i.palette),t.appendChild(n),l.wrap=t,t.style.display="none",c.bindEvents()},createSelect:function(t,n,i){var r,a,o=e.create("select",{className:t||""}),s=Object.prototype.toString,u=0;for(r=0;a=n[r];r++)if("[object Object]"===s.call(a)){if(a.value===i)u=r;o.options.add(new Option(a.text,a.value))}else{if(a===i)u=r;o.options.add(new Option(a,a))}return o.selectedIndex=u,o},bindEvents:function(){var e=l.view;a(e.family,"change",d.setFontFamily),a(e.fontSize,"change",d.setFontSize),a(l.wrap,"click",d.clickHandle),a(e.palette,"click",d.onColorSelect)},bindBlankEvent:function(){a(document,"click",d.onBlankClick)},unbindBlankEvent:function(){n.un(document,"click",d.onBlankClick)},showSelect:function(){var e=l.view;if("none"!==l.wrap.style.display)if(t.ie)e.family.style.visibility="visible",e.fontSize.style.visibility="visible"}},d={onColorSelect:function(e){var t=e||window.event,n=t.target||t.srcElement;if("span"===n.tagName.toLowerCase())d.setColor(t,n)},setFontFamily:function(){exports.emit("fontfamilychange",this.options[this.selectedIndex].value)},setFontSize:function(){exports.emit("fontsizechange",this.options[this.selectedIndex].value)},onBlankClick:function(e){var t=e||window.event,n=t.target||t.srcElement;if(n!==l.view.palette)d.hidePalette()},clickHandle:function(t){var n=t||window.event,i=n.target||n.srcElement;if(e.hasClass(i,"m-font-bold"))d.setBold(i);else if(e.hasClass(i,"m-font-italic"))d.setItalic(i);else if(e.hasClass(i,"m-font-underline"))d.setUnderline(i);else if(e.hasClass(i,"m-font-color"))d.showPalette(n,i)},setBold:function(t){if(!l._b)e.addClass(t,"m-font-bold-on"),l._b=!0;else e.removeClass(t,"m-font-bold-on"),l._b=!1;exports.emit("fontboldchange",l._b)},setItalic:function(t){if(!l._i)e.addClass(t,"m-font-italic-on"),l._i=!0;else e.removeClass(t,"m-font-italic-on"),l._i=!1;exports.emit("fontitalicchange",l._i)},setUnderline:function(t){if(!l._u)e.addClass(t,"m-font-underline-on"),l._u=!0;else e.removeClass(t,"m-font-underline-on"),l._u=!1;exports.emit("fontunderlinechange",l._u)},showPalette:function(t,i){n.stopPropagation(t),i.blur(),l.view.palette.style.display="",e.addClass(i,"m-font-color-on"),c.bindBlankEvent()},hidePalette:function(){var t=l.view;t.palette.style.display="none",e.removeClass(t.fontColor,"m-font-color-on"),c.unbindBlankEvent()},setColor:function(e,t){n.preventDefault(e),d.hidePalette(),exports.emit("fontcolorchange",t.style.backgroundColor)}};return exports.init=c.init,exports.toggle=function(t){var n=l.wrap;if(t.blur(),""===n.style.display)n.style.display="none",e.removeClass(t,"btn-font-active");else n.style.display="",e.addClass(t,"btn-font-active"),c.showSelect()},exports.hideSelect=function(){var e=l.view;if("none"!==l.wrap.style.display){if(t.ie)e.family.style.visibility="hidden",e.fontSize.style.visibility="hidden";e.palette.style.display="none"}},exports.showSelect=c.showSelect,exports}),define("front/webimlite/im/face",["require","../base/dom","../base/event","qiao-im-core","./config"],function(require){var e=require("../base/dom"),t=require("../base/event"),n=require("qiao-im-core"),i=n.lib.mixin,r=e.g,a=require("./config"),o=t.on,s=t.un,u={ROOT:a.URL.POOL_ROOT+a.FACE_ROOT,FACE_TAB:"FaceTab",FACE_GROUP:"FaceGroup",ROW:6,CELL:12,wrap:null,curEle:null},exports={};i(exports);var l={init:function(t,n,i){u.ROOT=a.URL.POOL_ROOT+a.FACE_ROOT;var o,s,c,d,f=[],p=[],m=a.face.items,h=u.ROOT,g=/^((http|https|ftp):)/.test(h)?h:window.location.protocol+h;t=r(t),n=n||u.ROW,i=i||u.CELL,f.push('<table cellspacing="0" cellpadding="0">');for(o in m)p.push({name:m[o].name,md5:m[o].md5+"."+m[o].type});for(var c=0,v=0;n>c;c++){f.push("<tr>");for(var s=0;i>s;s++){if(d=p[v])f.push('<td><a href="javascript:;"><img src="'+g+d.md5+'" title="'+d.name+'" alt="'+d.name+'" class="J-face-item" /></a></td>');else f.push("<td><span></span></td>");v++}f.push("</tr>")}f.push("</table>"),t.innerHTML=f.join(""),e.addClass(t,"BD-QIAO-IM-FACE-WRAP"),u.wrap=t,t.style.display="none",l.bindEvents(t)},bindEvents:function(e){o(e,"click",c.clickHandle)},bindBlankEvent:function(){o(document,"click",c.onBlankClick)},unbindBlankEvent:function(){s(document,"click",c.onBlankClick)},hide:function(){u.wrap.style.display="none",exports.emit("facehide",u.curEle),l.unbindBlankEvent()}},c={onBlankClick:function(e){var t=e||window.event,n=t.target||t.srcElement;if(n!==u.curEle)l.hide()},clickHandle:function(n){var i=n||window.event,r=i.target||i.srcElement;if(t.stopPropagation(i),e.hasClass(r,"J-face-tab"))c.switchTab(i,r);else if(e.hasClass(r,"J-face-item"))c.insert(i,r)},switchTab:function(n,i){t.preventDefault(n),e.addClass(i,"active"),i.blur();var a,o,s=r(u.FACE_TAB).getElementsByTagName("a"),l=r(u.FACE_GROUP).getElementsByTagName("table");for(a=0,o=s.length;o>a;a++){if(s[a]!==i)e.removeClass(s[a],"active");if(l[a].id+"Tab"!==i.id)l[a].style.display="none";else l[a].style.display=""}},insert:function(e,n){t.preventDefault(e),l.hide();var i='<img src="'+n.src+'" data-type="face" alt="'+n.title+'"/>';exports.emit("faceselect",i)}};return exports.init=l.init,exports.show=function(e){u.curEle=e,u.wrap.style.display="",exports.emit("faceshow"),l.bindBlankEvent()},exports.hide=l.hide,exports}),define("front/webimlite/im/editor",["require","../base/dom","../base/browser","../base/event","qiao-im-core","./face","./font","../base/localstorage"],function(require){function e(){var e=d.getItem("BRIDGE_HOTKEY");if("E"===e)n.addClass(n.g("E"),"selected"),n.removeClass(n.g("CE"),"selected");else n.removeClass(n.g("E"),"selected"),n.addClass(n.g("CE"),"selected")}function t(){m.shortKey.style.display="none",n.removeClass(n.q("m-send-method-btn")[0],"arrow")}var n=require("../base/dom"),i=require("../base/browser"),r=require("../base/event"),a=n.create,o=r.on,s=require("qiao-im-core"),u=(s.lib,s.lib.mixin),l=require("./face"),c=require("./font"),d=require("../base/localstorage"),f={tool:'<a href="#" class="m-lite-tool-btn btn-face" title="选择表情"></a><a href="#" class="m-lite-tool-btn btn-export" title="导出聊天记录"></a>',BTN:'<div class="m-send-btn"><a class="m-send-main btn-send">发送</a><span class="m-send-method-btn"><i></i></span></div>',SHORTKEY:'<a href="#" id="E">按Enter发送</a><a href="#" id="CE">按Ctrl+Enter发送</a>',editor:'<html><head><style type="text/css">html,body{height:100%;padding:0px;margin:0px; overflow-x:hidden}p{margin:0px}img{margin:0 2px}</style></head><body style="font-size:9pt;padding:0 5px;line-height:1.5;font-family:微软雅黑;cursor:text;box-sizing:border-box;overflow-y:auto;*overflow:auto;"></body></html>'},p="CE",m={},exports={};u(exports);var h={getCursorTimer:null},g=300,v={},b={INIT:function(t,n){var i;if(m.tool=a("div",{className:"m-lite-tool"}),m.tool.innerHTML=f.tool,m.face=a("div",{className:"m-lite-tool-face"}),m.tool.appendChild(m.face),m.font=a("div",{className:"m-lite-tool-font"}),m.tool.appendChild(m.font),m.btn=a("div",{className:"m-lite-btn",id:"send"}),n.bgColor)m.btn.style.cssText="background-color:"+n.bgColor;if(m.btn.innerHTML=f.BTN,m.shortKey=a("div",{className:"m-send-method",style:"display: none"}),m.shortKey.innerHTML=f.SHORTKEY,m.toolAndSend=a("div",{className:"m-lite-tool-and-send"}),m.clear=a("div",{className:"m-lite-clear"}),m.toolAndSend.appendChild(m.tool),m.toolAndSend.appendChild(m.btn),m.toolAndSend.appendChild(m.clear),m.btn.appendChild(m.shortKey),m.inputArea=a("div",{className:"m-lite-input-area"}),m.input=a("iframe",{frameborder:0,id:"editor"}),m.inputArea.appendChild(m.input),t.appendChild(m.inputArea),t.appendChild(m.toolAndSend),m.wrap=t,l.init(m.face,6,10),c.init(m.font),i=m.input.contentWindow.document,i.open(),i.write(f.editor),i.close(),i.designMode="on",b.bindEvents(),null===d.getItem("BRIDGE_HOTKEY")){var r=new Date;r.setFullYear(r.getFullYear()+1),d.setItem("BRIDGE_HOTKEY",p,{expires:r})}e()},bindEvents:function(){var e=m.input.contentWindow.document;if(o(m.wrap,"click",v.clickHandle),o(e,"keydown",v.handleInput),o(e,"click",v.clickMontior),o(document,"click",v.hideShortKey),o(m.shortKey,"click",v.changeShortKey),i.ie)o(window.document.body,"click",v.stopAutoSaveRange),o(e,"click",v.autoSaveRange),o(e,"keyup",v.autoSaveRange),o(e,"select",v.autoSaveRange);l.on("faceshow",v.onFaceShow),l.on("facehide",v.onFaceHide),l.on("faceselect",v.onFaceSelect),c.on("fontshow",v.onFontShow),c.on("fonthide",v.onFontHide),c.on("fontboldchange",v.onFontBoldChange),c.on("fontitalicchange",v.onFontItalicChange),c.on("fontunderlinechange",v.onFontUnderlineChange),c.on("fontfamilychange",v.onFontFamilyChange),c.on("fontsizechange",v.onFontSizeChange),c.on("fontcolorchange",v.onFontColorChange)},getRange:function(){var e=m.input.contentWindow;if(i.ie&&i.ie<11)return e.document.selection.createRange();else{var t=e.getSelection();return t.rangeCount?t.getRangeAt(0):e.document.createRange()}},getEditorBody:function(){return m.input.contentWindow.document.body},editorFocus:function(){var e=m.input.contentWindow;e.focus();var t=h.range||b.getRange();if(i.ie<11)t.select();else{var n=e.getSelection();n.removeAllRanges(),n.addRange(t)}},getEditorStyle:function(){var e,t,n={},i=b.getEditorBody(),r=["fontFamily","fontSize","color","fontWeight","fontStyle","textDecoration"];for(e=0;t=r[e];e++)if(i.style[t])n[t]=i.style[t];return n},isInEditor:function(e){var t=m.input.contentWindow.document.body,n=window.document.body,i=e.focusNode||e.commonAncestorContainer||e.parentElement();do if(i===t)return!0;else if(i===n)return!1;else i=i.parentNode;while(i)}};return v={clickMontior:function(){exports.emit("focus"),l.hide(),t()},hideShortKey:function(e){var n=e.target||e.srcElement,i=n.tagName.toLowerCase();if("i"===i&&n.parentNode.className.indexOf("m-send-method-btn")>-1||n.className.indexOf("m-send-method-btn")>-1)return!1;else return void t()},changeShortKey:function(t){var n=t.target||t.srcElement;d.setItem("BRIDGE_HOTKEY",n.id),e()},clickHandle:function(e){var t=e||window.event,i=t.target||t.srcElement;if(n.hasClass(i,"btn-face"))v.showFace(i);else if(n.hasClass(i,"btn-font"))v.toggleFont(i);else if(n.hasClass(i,"btn-export"))v.exportHistory()},saveRange:function(){var e=b.getRange();if(b.isInEditor(e))h.range=e},autoSaveRange:function(){v.saveRange(),v.stopAutoSaveRange(),h.getCursorTimer=setTimeout(function(){v.autoSaveRange()},g)},stopAutoSaveRange:function(){clearTimeout(h.getCursorTimer)},exportHistory:function(){exports.emit("exporthistory")},onFontBoldChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.fontWeight=e?"bold":"normal"},onFontItalicChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.fontStyle=e?"italic":"normal"},onFontUnderlineChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.textDecoration=e?"underline":"none"},onFontFamilyChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.fontFamily=e?e:"宋体"},onFontSizeChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.fontSize=e?e:"9pt"},onFontColorChange:function(e){b.editorFocus();var t=b.getEditorBody();t.style.color=e?e:"#000"},showFace:function(e){e.blur(),n.addClass(e,"btn-face-active"),l.show(e)},toggleFont:function(e){c.toggle(e)},onFaceShow:function(){c.hideSelect()},onFaceHide:function(e){if(c.showSelect(),e)n.removeClass(e,"btn-face-active")},onFaceSelect:function(e){var t=m.input.contentWindow,n=t.document;if(t.focus(),i.ie){if(i.ie<11){var r=h.range||b.getRange();r.select(),r.pasteHTML(e),r.select()}else{var a=t.getSelection(),r=a.getRangeAt(0),o=h.range?h.range:r,s=n.createElement("span");r.deleteContents(),s.innerHTML=e,o.insertNode(s),o.setStartAfter(s),r.setStartAfter(s),r.collapse(!0),a.removeAllRanges(),a.addRange(r)}v.saveRange();for(var u=n.getElementsByTagName("img"),l=u.length,c=0;l>c;c++)u[c].onresizestart=function(){return!1}}else n.execCommand("insertHTML",!1,e)},forbid:function(e){if(116===e.keyCode){if(i.ie)e.keyCode=0;return r.preventDefault(e),!1}if(e.ctrlKey&&82===e.keyCode||e.altKey&&39===e.keyCode||e.altKey&&37===e.keyCode||e.shiftKey&&121===e.keyCode)return r.preventDefault(e),!1;else return void 0},handleInput:function(e){var t=e||window.event;if(v.forbid(t),83===t.keyCode&&t.altKey)return r.preventDefault(t),void exports.emit("editorsend");if("CE"===d.getItem("BRIDGE_HOTKEY")||null===d.getItem("BRIDGE_HOTKEY")){if(13===t.keyCode&&t.ctrlKey&&!n.q("m-lite-opt-unablebtn").length)exports.emit("editorsend")}else if(13===t.keyCode){if(r.preventDefault(t),t.ctrlKey||t.shiftKey){var a,o=n.g("editor").contentWindow,s=o.document,u='<br><span style="display:none" id="HackBlank">&nbsp;</span>';if(i.ie)if(i.ie<11)a=s.selection.createRange(),a.select(),a.pasteHTML(u),a.select();else{var l=o.getSelection();a=l.getRangeAt(0);var c=o.range?o.range:a,f=s.createElement("span");a.deleteContents(),f.innerHTML=u,c.insertNode(f),c.setStartAfter(f),a.setStartAfter(f),a.collapse(!0),l.removeAllRanges(),l.addRange(a)}else{if(i.firefox||i.chrome)u="<div><br></div>";s.execCommand("insertHTML",!1,u)}var p=s.getElementById("HackBlank");return void(p&&p.parentNode.removeChild(p))}if(!n.hasClass(n.g("send"),"m-lite-opt-unablebtn"))exports.emit("editorsend")}}},exports.getStyle=b.getEditorStyle,exports.getContent=function(){return b.getEditorBody().innerHTML},exports.clear=function(){b.getEditorBody().innerHTML=""},exports.isMultilineMode=function(){return"CE"===p},exports.init=b.INIT,exports}),define("front/webimlite/im/lang",["require","exports"],function(require,exports){exports.TEXT={WELCOME:"您好！有什么需要帮忙的么？",DEFAULT_CSNAME:"在线客服",FILE_UNSUPPORT:"[文件]",FACE_UNSUPPORT:"[扩展头像]",IMG_UNSUPPORT:"[图片]",CFACE_UNSUPPORT:"[自定义头像]",ONLINE:"客服#{0}已经上线了，您现在可以发起沟通！",TRANSFER:"您已被转移给其他客服",INPUT:"正在输入..."},exports.ERROR={INIT:"对不起，转接失败，请稍后重试连接",CONFLICT:"您输入的内容存在安全隐患，发送失败",OFFLINE:"客服已经离线，您目前无法发送消息",SEND_FAIL:"消息发送失败，请稍后重试",DROP_KICKED:"本次沟通结束，请您继续浏览网站",DROP_CHATOVER:"本次沟通结束，请您继续浏览网站",KICKED:"由于网络原因，您已离线"}}),define("front/webimlite/im/config",["require","exports"],function(require,exports){exports.FACE_ROOT="img/webim/defaultface/";var e={};exports.jscode={jscode:""},exports.authCode="";var t={title:"默认分组",items:[{name:"微笑",shortcut:":)",md5:"c7b91efe2e01b35d9ff088993ca9a11a",type:"png",frame:"0"},{name:"大笑",shortcut:":D",md5:"73a512491b0e3e12099ed7900cd4482d",type:"gif",frame:"0"},{name:"偷笑",shortcut:"(tx)",md5:"5394895d38f997b201036acf646ab181",type:"gif",frame:"2"},{name:"憨笑",shortcut:":o",md5:"2b257b850465aa84dfa9d7170515ac57",type:"gif",frame:"0"},{name:"得意",shortcut:"(dy)",md5:"8372252a0bbffba66ded3a8fa71ff410",type:"gif",frame:"0"},{name:"可爱",shortcut:"(ka)",md5:"e51b1712edec1b5c5f751fbb7374a3b0",type:"gif",frame:"0"},{name:"害羞",shortcut:"(hx)",md5:"6d3fdbc79e3568e66a1f3411dfc0a30c",type:"gif",frame:"4"},{name:"乖",shortcut:"(oo)",md5:"a024381379da74153694c4ebb9f75014",type:"gif",frame:"0"},{name:"淘气",shortcut:"(tq)",md5:"ee5ab8e89776a17d26367d131f77bea3",type:"png",frame:"0"},{name:"调皮",shortcut:":p",md5:"1cc3b63e1bf9753bcecf8e99185c3d74",type:"png",frame:"2"},{name:"流泪",shortcut:"(ll)",md5:"3fbeb731a465584bc3b2c5b84333860c",type:"gif",frame:"2"},{name:"大哭",shortcut:":(",md5:"e7daaaf6031549140d88e46154445e2c",type:"gif",frame:"2"},{name:"撇嘴",shortcut:"(pz)",md5:"95af917d5ccfb614ec03731f686f1c49",type:"png",frame:"0"},{name:"闭嘴",shortcut:":-#",md5:"d267f14a949cc1c67d5afebea631b95f",type:"gif",frame:"2"},{name:"嘘",shortcut:"(xu)",md5:"2d962d090c00a534c3cb604a3409c8a9",type:"gif",frame:"3"},{name:"鄙视",shortcut:"(bs)",md5:"6e5a6dd0094a5f413c9d40d703552563",type:"gif",frame:"0"},{name:"傲慢",shortcut:"(am)",md5:"a7792b792338c0824e4eba4e8f53f248",type:"png",frame:"0"},{name:"白眼",shortcut:"(fc)",md5:"9046a275b6fcc032d552c2be28deda85",type:"gif",frame:"0"},{name:"思考",shortcut:"(sk)",md5:"f68391b534ad9c6e2980e1c9f4248b7b",type:"gif",frame:"2"},{name:"困",shortcut:"|-)",md5:"2939123abba6052d64383ad7cd62983d",type:"gif",frame:"1"},{name:"睡",shortcut:"(zz)",md5:"e79f016440edafd4ba3f5c7f45077883",type:"gif",frame:"2"},{name:"汗",shortcut:"(lh)",md5:"c0d21388d259446932b1d2c84a243c4b",type:"gif",frame:"1"},{name:"尴尬",shortcut:":$",md5:"f57200e594d2c74dae63321a685c0a01",type:"gif",frame:"2"},{name:"惊讶",shortcut:":-o",md5:"f3807c4d0dfd29864538bff866f8e8d2",type:"png",frame:"0"},{name:"惊恐",shortcut:"(jk)",md5:"2e855936c4d0e3a8d8925c6ff7033802",type:"gif",frame:"0"},{name:"疑问",shortcut:"(?)",md5:"efa51b9fd7f230928f589f72de2510ab",type:"gif",frame:"0"},{name:"晕",shortcut:":s",md5:"3b9b9fa53da41b2be65de19bbfa3f477",type:"gif",frame:"0"},{name:"敲打",shortcut:"(qd)",md5:"7add275c91a9130f9e3b1ba52eb8e8d6",type:"GIF",frame:"2"},{name:"难过",shortcut:":(",md5:"fd0771f664dee6d809213572cb825efa",type:"png",frame:"0"},{name:"委屈",shortcut:"(wq)",md5:"125b1fee2dcae224a46500185c41f74e",type:"gif",frame:"0"},{name:"色",shortcut:"(se)",md5:"a9bb9d9d9bd83c530585f32139ca7e07",type:"gif",frame:"0"},{name:"抓狂",shortcut:"(zk)",md5:"2748bd8030e2db488dbf96b833e73233",type:"gif",frame:"1"},{name:"愤怒",shortcut:":@",md5:"60f3c02d34d47ec70a1a93304606d5bf",type:"GIF",frame:"0"},{name:"吐",shortcut:"+o(",md5:"70347b086d5d1b58cb6afac1c5a709b6",type:"gif",frame:"2"},{name:"衰",shortcut:"(sh)",md5:"c93d82cc99597cd2af1e1de3bfe96dcc",type:"png",frame:"0"},{name:"再见",shortcut:"(zj)",md5:"1d6e9bfd1eb9db00a2f5002660de7bd5",type:"gif",frame:"0"},{name:"左拥抱",shortcut:"({)",md5:"6f2c8b9cc8b654852b8765f9de36ea7b",type:"png",frame:"0"},{name:"右拥抱",shortcut:"(})",md5:"835c7ed5ebc0638a4290dc2bc5075293",type:"png",frame:"0"},{name:"闪人",shortcut:"(sr)",md5:"638e9e5693be2e25b7fb49ef53dccd59",type:"png",frame:"0"},{name:"刀",shortcut:"(d)",md5:"79049e7bb24e1610fa3172ffc9c6afbe",type:"gif",frame:"2"},{name:"吻",shortcut:"(w)",md5:"b4717e8c1be2396f59424edb642f346f",type:"png",frame:"0"},{name:"爱情",shortcut:"(ai)",md5:"df8cd7fb1a5402081bba02ed27f3d460",type:"png",frame:"0"},{name:"心碎",shortcut:"(xs)",md5:"9a48f0d784b340130ddc548bbe0e41b1",type:"gif",frame:"1"},{name:"鲜花",shortcut:"(xh)",md5:"e0ef4acf693e8bd332304539c3d556e6",type:"png",frame:"0"},{name:"枯萎",shortcut:"(kw)",md5:"e3d5d44d18592e744a877028ccd5ce7e",type:"png",frame:"0"},{name:"胜利",shortcut:"(sl)",md5:"c12b4546988745b970a528e9d4c7d36b",type:"gif",frame:"0"},{name:"OK",shortcut:"(ok)",md5:"ea9118eeb5d1251204aa06ac676d039c",type:"png",frame:"0"},{name:"大拇指",shortcut:"(n)",md5:"df9f3c4d0296f6971a88f38836da30b3",type:"gif",frame:"0"},{name:"弱",shortcut:"(r)",md5:"0700d37ba0b4b48503971f10d1e4b043",type:"gif",frame:"0"},{name:"握手",shortcut:"(ws)",md5:"af63cb39facadd039efa04da4b29c160",type:"gif",frame:"0"},{name:"蛋糕",shortcut:"(^)",md5:"71069905c70351d3b61d252c7bbea5cf",type:"gif",frame:"0"},{name:"咖啡",shortcut:"(kf)",md5:"a119c664f4d00bf17448bb4a77b761c0",type:"gif",frame:"0"},{name:"吃饭",shortcut:"(cf)",md5:"f64ed5b3c7d9c934847aeacda0743cbe",type:"png",frame:"0"},{name:"太阳",shortcut:"(#)",md5:"c6889c8bdd7ee08445e5009b803a29aa",type:"png",frame:"0"},{name:"月亮",shortcut:"(s)",md5:"7d1f68af6f74d00649c664a99f546b76",type:"png",frame:"0"},{name:"星星",shortcut:"(*)",md5:"0d11d94e64e06bc04c42d64a77834444",type:"png",frame:"0"},{name:"便便",shortcut:"(bb)",md5:"a811e4d3e0bf451c4716401ac251d056",type:"gif",frame:"0"},{name:"猪头",shortcut:"(zt)",md5:"8260d8878f182d0b3c6aa46d933fc216",type:"png",frame:"0"},{name:"钱",shortcut:"(q)",md5:"d6b4a948530ed9dbb34e53e63dfc910",type:"png",frame:"0"},{name:"Hi",shortcut:"(hi)",md5:"d98dc2c9584121f0a863c3d608cd3503",type:"png",frame:"2"}]};exports.face=t,exports.init=function(t){e.POOL_ROOT=t.poolRoot,e.HI_SERVER=t.IMroot,e.QIAO_ROOT=t.root},exports.URL=e}),define("front/webimlite/base/object",["require","exports"],function(require,exports){exports.extend=function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}),define("front/webimlite/base/date",["require","exports"],function(require,exports){function e(e,t){var n="",i=0>e,r=String(Math.abs(e));if(r.length<t)n=new Array(t-r.length+1).join("0");return(i?"-":"")+n+r}exports.format=function(t,n){function i(e,t){n=n.replace(e,t)}if("string"!=typeof n)return t.toString();var r=t.getFullYear(),a=t.getMonth()+1,o=t.getDate(),s=t.getHours(),u=t.getMinutes(),l=t.getSeconds();return i(/yyyy/g,e(r,4)),i(/yy/g,e(parseInt(r.toString().slice(2),10),2)),i(/MM/g,e(a,2)),i(/M/g,a),i(/dd/g,e(o,2)),i(/d/g,o),i(/HH/g,e(s,2)),i(/H/g,s),i(/hh/g,e(s%12,2)),i(/h/g,s%12),i(/mm/g,e(u,2)),i(/m/g,u),i(/ss/g,e(l,2)),i(/s/g,l),n},exports.dataFormat=function(e){if(e){var t=e.getHours();t=t>9?t:"0"+t;var n=e.getMinutes();n=n>9?n:"0"+n;var i=e.getSeconds();i=i>9?i:"0"+i;var r=t+":"+n+":"+i;return r}}}),define("front/base/lang",[],function(){"use strict";function e(e){return"[object Array]"===n.call(e)}function t(e){return!(!e||!i.test(e))}var n={}.toString,i=/\{\s*\[(?:native code|function)\]\s*\}/i;return{isNative:t,isArray:t(Array.isArray)?Array.isArray:e,isObject:function(e){return e&&"[object Object]"===n.call(e)},isFunction:function(e){return e&&"[object Function]"===n.call(e)},instanceOf:function(e,t){return e&&e.hasOwnProperty&&e instanceof t},extend:function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}}}),define("front/data/config",["require","exports","../base/lang"],function(require,exports){"use strict";function e(){for(var e,t=location.href,n=0,i=null;e=r[n];n++)if(e.url==t||t.indexOf(e.url)>-1)!i&&(i=e),i&&i.url&&i.url.length<e.url.length&&(i=e);if(i)return i.pageid;else return"0"}var t=require("../base/lang"),n="undefined"!=typeof BDBridgeConfig?window.BDBridgeConfig:{},i=n.BD_BRIDGE_DATA||{},r=n.BD_BRIDGE_SPECIAL||[],a={},o=function(){for(var t,i=n.BD_BRIDGE_STYLE_ITEM||[],a=r&&r.length<=0?"0":e(),o=0;t=i[o];o++)if(t.pageid==a)return t}(),s="";return{getSiteId:function(){return i.siteid||""},getUcId:function(){return i.ucid||""},getSiteIdMd5:function(){return i.SITE_ID||""},getRoot:function(){return n.ROOT},getLogRoot:function(){return n.LOG_ROOT||"//scqiao.baidu.com/"},getPoolRoot:function(){return n.POOL_ROOT||"//hqiao.baidu.com/f/pool/"},getRcvRoot:function(){return n.RCV_ROOT},getImRoot:function(){return n.IM_ROOT||"//p.qiao.baidu.com/"},getFrontRoot:function(){return n.FRONT_ROOT},getMainId:function(){return i.mainid||""},getUserName:function(){return i.userName||""},getStyleConfig:function(module){if(!module)return o;else return o["BD_BRIDGE_"+module.toUpperCase()]||{}},setStyleConfig:function(module,e){if(module)module="BD_BRIDGE_"+module.toUpperCase(),o[module]=t.extend(o[module],e)},getAllowGroup:function(){return o.BD_BRIDGE_GROUP||[]},getPageId:function(){return"0"==o.pageid?"":o.pageid},setModelData:function(e){a=t.extend(a,e)},getModelData:function(e){if(!e)return a;else return a[e]},getStartTime:function(){return n.TIME_START},setJsFunction:function(e){s="return "+e},getJsFunctionResult:function(){if(s){var e=new Function(s);return e()()}else return null},getIsWebIm:function(){var e=this.getStyleConfig().BD_BRIDGE_WEBIM.webimtype;return e},isAuthCode:!1,authCode:"",isSecondVerify:!1,jscodeForLog:function(){return s}}}),define("front/common/identity",["require","../data/config"],function(require){function e(){var e=a;return window[e]||(window[e]={})}var t=require("../data/config"),n=t.getSiteId(),i="QIAO_COOKIE_",r="QIAO_LS_"+n+"_",a="QIAO_NS_BSL",o="bridge",s={bid:n+"bid24",data:n+"data",show:n+"show",instance:n+"instance",chat:n+"chat",startload:n+"startload",ack:n+"ack",firstInfo:n+"firstInfo",prevInfo:n+"previousInfo",offsetTime:n+"offsetTime"},u={BY_INVITE:4,BY_SELF:1,AUTO_INVITE:3,ENFORCE:5};return{cookieId:function(e){return i+e.toUpperCase()},getLSKey:function(e){return r+e.toUpperCase()},getFlashId:function(){return o},getFlashKey:function(e){return s[e]||""},getBSLNs:function(){return e()},getChatType:function(e){if(0===u[e])return 0;else return u[e]||u.BY_SELF}}}),define("front/base/Promise",[],function(){function e(){this._callbacks=[]}return e.prototype.then=function(t,n){var i,r=this;if(r._isdone)i=t.apply(n,r.result);else i=new e,r._callbacks.push(function(){var e=t.apply(n,arguments);if(e&&"function"==typeof e.then)e.then(i.done,i)});return i},e.prototype.done=function(){var e=this;e.result=arguments,e._isdone=!0;for(var t=0,n=e._callbacks.length;n>t;t++)e._callbacks[t].apply(null,arguments);e._callbacks=[]},e.prototype.promise=function(){var e=this;return{then:function(){e.then.apply(e,arguments)}}},e}),define("front/webimlite/base/localstorage",["require","exports","./json","./browser"],function(require,exports){var e=require("./json"),t=require("./browser"),n=function(){var t,n=null,i=365;return{build:function(e){var n=this;return e=e||{},t=e.fileName||location.hostname,i=e.expires||i,n},_setup:function(){if(!n)try{n=document.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),document.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(r,a){var o=this,s=new Date;if(o._setup())a="string"==typeof a?a:e.stringfy(a),s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(r,a),n.save(t)},getItem:function(e){var i=this;if(i._setup())return n.load(t),n.getAttribute(e)},removeItem:function(e){var i=this;if(i._setup())n.load(t),n.removeAttribute(e),n.save(t)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}(),i={INTERVAL:1e3,ls:null,useTimer:t.ie&&t.ie<8,timer:null,keyEvent:{}},r={onStorage:function(e,t,n){var r=i.ls.getItem(e);return n=n||null,function(a){setTimeout(function(){a=a||window.storageEvent;var o=a.key,s=a.newValue;if(!o){var u=i.ls.getItem(e);if(u!==r)o=e,s=u}if(o===e)t&&t.call(n,a.oldValue||r,s),r=s},0)}}};exports.init=function(e){if(window.localStorage)i.ls=window.localStorage;else i.ls=n,i.ls.build(e)},exports.setItem=function(t,n){return n="string"==typeof n?n:e.stringify(n),i.ls.setItem(t,n)},exports.getItem=function(e){return i.ls.getItem(e)},exports.removeItem=function(e){return i.ls.removeItem(e)},exports.clear=function(){i.ls.clear()},exports.addStorageEvent=function(e,n){var a;if(!i.useTimer)if(a=r.onStorage(e,n),document.attachEvent&&!t.opera)document.attachEvent("onstorage",a);else window.addEventListener("storage",a,!1);else a=r.onStorage(e,n),i.timer=setInterval(function(){a({})},i.INTERVAL)},exports.removeStorageEvent=function(e,t){}}),define("qiao-im-core/log/log",["require","../base/util"],function(require){function e(e){return n(e)+"&_t="+(new Date).getTime()}function t(e){var t=new Image;t.onload=t.onerror=function(){t=null},t.src=e}var n=require("../base/util").jsonToQuery,i="//scqiao.baidu.com/front/",exports={};return exports.sendLog=function(n,r){var a=i+n+".gif?"+e(r);t(a)},exports}),define("qiao-im-core/log/chat",["require","../rcv/enter","../im/connect","../im/send","./log","../data","../base/util"],function(require){function e(){v.imuss=m.get("bid"),v.ucid=m.get("ucid"),v.siteid=m.get("siteid"),v.type=m.get("type"),b=h.extend(b,v),y=h.extend(y,v),w=h.extend(w,v)}function t(){c.on("enterfail",n),d.on(d.EVENT.WELCOME,i),d.on(d.EVENT.BRIDGEINIT,r),f.on("communicatefail",a),f.on("communicatesend",o)}function n(){p.sendLog("transfer",b)}function i(e,t){if("error"===e)n()}function r(e,t){if("success"===e)b.consume=(new Date).getTime()-m.get("startTime"),b.status="ok",b.inited=m.get("inited");n()}function a(e){y.msgid=e.messageid,p.sendLog("sendfail",y)}function o(){w.num++}function s(){if(w.num)p.sendLog("sendtotal",w),w.num=0}function u(){s(),clearTimeout(l),l=setTimeout(function(){u()},g)}var l,c=require("../rcv/enter"),d=require("../im/connect"),f=require("../im/send"),p=require("./log"),m=require("../data"),h=require("../base/util"),g=5e3,v={siteid:"",ucid:"",imuss:"",dtype:0,type:1},b={consume:0,status:"fail",inited:0},y={msgid:""},w={num:0},exports={};return exports.init=function(){t(),e(),u()},exports}),define("qiao-im-core/log/stat",["require"],function(require){function e(){return Math.floor(1e10*Math.random())}function t(e){var t=new Image,n=l+"?"+e;t.onload=t.onerror=function(){t=null},t.src=n}function n(e,t){for(var n in e)if(e.hasOwnProperty(n))t[n]&&(e[n]=t[n])}function i(n){var i="si="+s.siteId+"&et=99&ep="+s.mainId;i+=r(n),i=i+d+e(),t(i)}function r(e){var t,n,i="",r=p.length;for(t=0;r>t;t++)n=p[t],i+=""===e[n]?"*"+c:"*"+e[n];return i}function a(e){if(m.visitor_count)n(u,e),u.eventId=f.VISITOR_IM,u.count=m.visitor_count,u.valid=1,i(u),m.visitor_count=0,u.valid=0}function o(e){if(!e.chatId)m.visitor_count+=e.count;else n(u,e),u.eventId=f.VISITOR_IM,u.valid=1,i(u),m.visitor_count=0,u.valid=0}var s={siteId:"",mainId:""},u={mainId:"",subId:"",sessionId:"",eventId:"",chatId:"",from:"",open:"",valid:"",count:""},l="http://hm.baidu.com/hm.gif",c=0,d="&nv=0&st=4&v=bridge-0.2&rnd=",f={REFRESH_IM:1,SEND_INVITE:3,ACCEPT_INVITE:4,SEND_MESS:5,VISITOR_IM:6,SERVER_IM:7,START_IM:0},p=["subId","sessionId","eventId","chatId","from","open","valid","count"],m={visitor_count:0};return function(e,t,r){if(e)switch(s.siteId=s.siteId||t.siteId||0,s.mainId=s.mainId||t.mainId||0,e=e.toUpperCase()){case"VISITOR_IM":o(r);break;case"START_IM":a(r);break;default:n(u,r),u.eventId=f[e],i(u)}}}),define("qiao-im-core/hm",["require","./log/stat","./im/send","./im"],function(require){function e(e){var n=u;n.mainId=e.mainId||"",n.siteId=e.siteId||"",n.sessionId=e.siteId&&e.bid&&e.siteId+"_"+e.bid||"",n.chatId=e.chatId,n.subId=e.subId||"",a("START_IM",{siteId:n.siteId,mainId:n.mainId},{subId:e.subId,sessionId:n.sessionId,chatId:n.chatId,open:n.open,count:1}),t()}function t(){var e=u;l=setInterval(function(){a("REFRESH_IM",{siteId:e.siteId,mainId:e.mainId},{subId:e.subId,sessionId:e.sessionId,chatId:e.chatId,open:e.open})},6e5)}function n(e){var t=u;a("VISITOR_IM",{siteId:t.siteId,mainId:t.mainId},{subId:t.subId,sessionId:t.sessionId,chatId:t.chatId,open:t.open,count:e&&e.count||1})}function i(e){var t=u;
if(t.chatId)a("SERVER_IM",{siteId:t.siteId,mainId:t.mainId},{subId:t.subId,sessionId:t.sessionId,chatId:t.chatId,open:t.open,count:e&&e.count||1})}function r(){if(l)clearInterval(l);u.chatId=""}var a=require("./log/stat"),o=require("./im/send"),s=require("./im"),u={mainId:"",siteId:"",subId:"",sessionId:"",chatId:"",open:1},l=null,exports={};return exports.init=function(){o.on("statCommunicate",n),s.on("statTaskBegin",e),s.on("statPickMessage",i),s.on("statPickOffline",r),s.on("statPickKick",r),s.on("statPickTransfer",r)},exports}),define("qiao-im-core/message/voice",["require","../base/string"],function(require){function e(e){var t=r[e];return function(e,n,i){var r=t(e);if(!r)return void i();var a=n[n.length-1];if(a&&"text"===a.type)a.text+=r;else n.push({type:"text",text:r});i()}}var t=require("../base/string").encodeHTML,n=require("../base/string").format,i={GET:'<span class="voice-tip">语音转译：</span><span>${voice}</span>'},r={voice:function(e){var r=t(e.c);return n(i.GET,{voice:r.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")})}},exports={};exports.decoder={};for(var a in r)if(r.hasOwnProperty(a))exports.decoder[a]=e(a);return function(){return exports}}),define("qiao-im-core/message/meta/phone",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/((\+86)|(86))?1([0-9]{10})/g,n={ENCODE:'<text c="${text}" type="card" subtype="phone" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-core/message/meta/qq",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=(require("../../base/string").encodeHTML,/[1-9][0-9]{4,14}/i),n={ENCODE:'<text c="${text}" type="card" subtype="qq" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-core/message/meta/tel",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})|([0-9]{4}|[0-9]{3})-([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1})|([0-9]{7,8})-([0-9]{4}|[0-9]{3}|[0-9]{2}|[0-9]{1}))/g,n={ENCODE:'<text c="${text}" type="card" subtype="tel" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-core/message/meta/email",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=/(\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+)/gi,n={ENCODE:'<text c="${text}" type="card" subtype="email" />'},exports={};return exports.encode=function(i,r,a){return i=i.replace(t,function(t){return a&&a.push(e(n.ENCODE,{text:t})),r})},exports}),define("qiao-im-core/message/meta/img",["require","../../base/string"],function(require){var e=require("../../base/string").format,t={SEND:'<img md5="${md5}" token="${token}" bcsname="${name}" source="bcs" t="${type}" n="screen"/>',GET:'<img data-fid="${bcsname}" src="${defaultImg}" />'},n=/(<img[^>]+(:?(:?data-token=[^>]+data-md5=[^>]*)|(:?data-md5=[^>]+data-token=[^>]*))>)/gi,exports={};return exports.encode=function(i,r,a){var o,s=document.createElement("div"),u="",l="",c="",d="";return i=i.replace(n,function(n,i){if(s.innerHTML=n,o=s.getElementsByTagName("img")[0],l=o.getAttribute("data-md5"),u=o.getAttribute("data-token"),c=o.getAttribute("data-fid"),d=o.getAttribute("data-type"),!(l&&u&&c&&"img"===d))return n;else return a&&a.push(e(t.SEND,{md5:l,token:u,name:c,type:"img"})),r})},exports}),define("qiao-im-core/message/meta/font",["require","../../base/util","../../base/string"],function(require){function e(e){return e=e.substr(5)+e.substr(3,2)+e.substr(1,2),parseInt(e,16)}function t(t){if(u.test(t))return e(t);else if(l.test(t))return n(t);return 0}function n(t){t=t.substring(4,t.length-1),t=t.split(",");var n=parseInt(t[0],10),i=parseInt(t[1],10),r=parseInt(t[2],10);if(n=n.toString(16),1==n.length)n="0"+n;if(i=i.toString(16),1==i.length)i="0"+i;if(r=r.toString(16),1==r.length)r="0"+r;return t=("#"+n+i+r).toUpperCase(),e(t)}function i(e){var t=e;if(isNaN(t))return"";else return t=new Number(t).toString(16).toUpperCase(),t=(s.COLOR.substr(1)+t).substr(t.length),t=s.COLOR.substr(0,1)+t.substr(4)+t.substr(2,2)+t.substr(0,2)}var r=require("../../base/util").extend,a=require("../../base/string").format,o={SEND:'<font n="${family}" c="${color}" s="${size}" b="${weight}" i="${style}" ul="${decoration}" />',GET:'<div style="font-family:${family};font-size:${size};color:${color};font-weight:${weight};font-style:${style};text-decoration:${decoration};"></div>'},s={COLOR:"#000000",SIZE_UNIT:"pt"},exports={},u=/^\#[\da-f]{6}$/i,l=/^[rgb|RGB]/;return exports.encode=function(e){var n=r({},e||{});return n.family=n.fontFamily||"simsun",n.size=parseInt(n.fontSize,10)||12,n.color=n.color?t(n.color):0,n.weight=n.fontWeight?1:0,n.style="italic"===n.fontStyle?1:0,n.decoration="underline"===n.fontDecoration?1:0,n=a(o.SEND,n)},exports.decode=function(e){var t=r({},e||{});return t.family=t.n,t.size=parseInt(t.s,10)<0?"":t.s+s.SIZE_UNIT,t.color=t.c?i(t.c):"",t.weight="1"===t.b?"bold":"",t.style="1"===t.i?"italic":"",t.decoration="1"===t.ul?"underline":"",t=a(o.GET,t)},exports}),define("qiao-im-core/message/meta/url",["require","../../base/string"],function(require){var e=require("../../base/string").format,t=require("../../base/string").encodeHTML,n=/((((https?|ftp):\/\/[\w-]+)|\bwww)(\.[\w-]+)+(:\d+)?(\/[\w\u4e00-\u9fa5\uf900-\ufa2d%-]+){0,}(\/|\.[\w-]+)*(\?[\w-]*(\.[\w-]+)*(=[^&=< >\r\n]*)?(&[\w-;]*(=[^&=< >\r\n]*)?){0,})?)/gi,i=/(<img[^>]+>)/im,r={DECODE:'<a target="_blank" href="${href}">${content}</a>',ENCODE:'<url ref="${ref}" />'},exports={};return exports.encode=function(a,o,s){for(var u=[];i.test(a);)u.push(RegExp.$1),a=a.replace(RegExp.$1,""+(u.length-1)+"");var l={};a=a.replace(n,function(n,i,a){return l.ref=("www"===a?"http://":"")+i.replace(/&amp;/g,"&"),l.ref=t(l.ref),s&&s.push(e(r.ENCODE,l)),o});for(var c=0;c<u.length;c++)a=a.replace(""+c+"",u[c]);return a},exports.decode=function(t){var n={},i=t.ref;n.href=(/^http/.test(i)?"":"http://")+i;var a=t.c||t.ref;return n.content=a.replace(/\r\n/gi,"<br>"),e(r.DECODE,n)},exports}),define("qiao-im-core/message/meta/face",["require","../../lang","../../base/string","../../common"],function(require){function e(e){for(var t,n=0;t=o[n];n++)if(t.name===e)return{name:e,img:a+t.md5};return null}var t=require("../../lang"),n=require("../../base/string").format,i=require("../../common").array.indexOf,r=["微笑","大笑","偷笑","憨笑","得意","可爱","害羞","乖","淘气","调皮","流泪","大哭","撇嘴","闭嘴","嘘","鄙视","傲慢","白眼","思考","困","睡","汗","尴尬","惊讶","惊恐","疑问","晕","敲打","难过","委屈","色","抓狂","愤怒","吐","衰","再见","左拥抱","右拥抱","闪人","刀","吻","爱情","心碎","鲜花","枯萎","胜利","OK","大拇指","弱","握手","蛋糕","咖啡","吃饭","太阳","月亮","星星","便便","猪头","钱","Hi"],a="//hqiao.baidu.com/f/pool/img/webim/defaultface/",o=[{name:"微笑",shortcut:":)",md5:"c7b91efe2e01b35d9ff088993ca9a11a.png"},{name:"大笑",shortcut:":D",md5:"73a512491b0e3e12099ed7900cd4482d.gif"},{name:"偷笑",shortcut:"(tx)",md5:"5394895d38f997b201036acf646ab181.gif"},{name:"憨笑",shortcut:":o",md5:"2b257b850465aa84dfa9d7170515ac57.gif"},{name:"得意",shortcut:"(dy)",md5:"8372252a0bbffba66ded3a8fa71ff410.gif"},{name:"可爱",shortcut:"(ka)",md5:"e51b1712edec1b5c5f751fbb7374a3b0.gif"},{name:"害羞",shortcut:"(hx)",md5:"6d3fdbc79e3568e66a1f3411dfc0a30c.gif"},{name:"乖",shortcut:"(oo)",md5:"a024381379da74153694c4ebb9f75014.gif"},{name:"淘气",shortcut:"(tq)",md5:"ee5ab8e89776a17d26367d131f77bea3.png"},{name:"调皮",shortcut:":p",md5:"1cc3b63e1bf9753bcecf8e99185c3d74.png"},{name:"流泪",shortcut:"(ll)",md5:"3fbeb731a465584bc3b2c5b84333860c.gif"},{name:"大哭",shortcut:":'(",md5:"e7daaaf6031549140d88e46154445e2c.gif"},{name:"撇嘴",shortcut:"(pz)",md5:"95af917d5ccfb614ec03731f686f1c49.png"},{name:"闭嘴",shortcut:":-#",md5:"d267f14a949cc1c67d5afebea631b95f.gif"},{name:"嘘",shortcut:"(xu)",md5:"2d962d090c00a534c3cb604a3409c8a9.gif"},{name:"鄙视",shortcut:"(bs)",md5:"6e5a6dd0094a5f413c9d40d703552563.gif"},{name:"傲慢",shortcut:"(am)",md5:"a7792b792338c0824e4eba4e8f53f248.png"},{name:"白眼",shortcut:"(fc)",md5:"9046a275b6fcc032d552c2be28deda85.gif"},{name:"思考",shortcut:"(sk)",md5:"f68391b534ad9c6e2980e1c9f4248b7b.gif"},{name:"困",shortcut:"|-)",md5:"2939123abba6052d64383ad7cd62983d.gif"},{name:"睡",shortcut:"(zz)",md5:"e79f016440edafd4ba3f5c7f45077883.gif"},{name:"汗",shortcut:"(lh)",md5:"c0d21388d259446932b1d2c84a243c4b.gif"},{name:"尴尬",shortcut:":$",md5:"f57200e594d2c74dae63321a685c0a01.gif"},{name:"惊讶",shortcut:":-o",md5:"f3807c4d0dfd29864538bff866f8e8d2.png"},{name:"惊恐",shortcut:"(jk)",md5:"2e855936c4d0e3a8d8925c6ff7033802.gif"},{name:"疑问",shortcut:"(?)",md5:"efa51b9fd7f230928f589f72de2510ab.gif"},{name:"晕",shortcut:":s",md5:"3b9b9fa53da41b2be65de19bbfa3f477.gif"},{name:"敲打",shortcut:"(qd)",md5:"7add275c91a9130f9e3b1ba52eb8e8d6.GIF"},{name:"难过",shortcut:":(",md5:"fd0771f664dee6d809213572cb825efa.png"},{name:"委屈",shortcut:"(wq)",md5:"125b1fee2dcae224a46500185c41f74e.gif"},{name:"色",shortcut:"(se)",md5:"a9bb9d9d9bd83c530585f32139ca7e07.gif"},{name:"抓狂",shortcut:"(zk)",md5:"2748bd8030e2db488dbf96b833e73233.gif"},{name:"愤怒",shortcut:":@",md5:"60f3c02d34d47ec70a1a93304606d5bf.GIF"},{name:"吐",shortcut:"+o(",md5:"70347b086d5d1b58cb6afac1c5a709b6.gif"},{name:"衰",shortcut:"(sh)",md5:"c93d82cc99597cd2af1e1de3bfe96dcc.png"},{name:"再见",shortcut:"(zj)",md5:"1d6e9bfd1eb9db00a2f5002660de7bd5.gif"},{name:"左拥抱",shortcut:"({)",md5:"6f2c8b9cc8b654852b8765f9de36ea7b.png"},{name:"右拥抱",shortcut:"(})",md5:"835c7ed5ebc0638a4290dc2bc5075293.png"},{name:"闪人",shortcut:"(sr)",md5:"638e9e5693be2e25b7fb49ef53dccd59.png"},{name:"刀",shortcut:"(d)",md5:"79049e7bb24e1610fa3172ffc9c6afbe.gif"},{name:"吻",shortcut:"(w)",md5:"b4717e8c1be2396f59424edb642f346f.png"},{name:"爱情",shortcut:"(ai)",md5:"df8cd7fb1a5402081bba02ed27f3d460.png"},{name:"心碎",shortcut:"(xs)",md5:"9a48f0d784b340130ddc548bbe0e41b1.gif"},{name:"鲜花",shortcut:"(xh)",md5:"e0ef4acf693e8bd332304539c3d556e6.png"},{name:"枯萎",shortcut:"(kw)",md5:"e3d5d44d18592e744a877028ccd5ce7e.png"},{name:"胜利",shortcut:"(sl)",md5:"c12b4546988745b970a528e9d4c7d36b.gif"},{name:"OK",shortcut:"(ok)",md5:"ea9118eeb5d1251204aa06ac676d039c.png"},{name:"大拇指",shortcut:"(n)",md5:"df9f3c4d0296f6971a88f38836da30b3.gif"},{name:"弱",shortcut:"(r)",md5:"0700d37ba0b4b48503971f10d1e4b043.gif"},{name:"握手",shortcut:"(ws)",md5:"af63cb39facadd039efa04da4b29c160.gif"},{name:"蛋糕",shortcut:"(^)",md5:"71069905c70351d3b61d252c7bbea5cf.gif"},{name:"咖啡",shortcut:"(kf)",md5:"a119c664f4d00bf17448bb4a77b761c0.gif"},{name:"吃饭",shortcut:"(cf)",md5:"f64ed5b3c7d9c934847aeacda0743cbe.png"},{name:"太阳",shortcut:"(#)",md5:"c6889c8bdd7ee08445e5009b803a29aa.png"},{name:"月亮",shortcut:"(s)",md5:"7d1f68af6f74d00649c664a99f546b76.png"},{name:"星星",shortcut:"(*)",md5:"0d11d94e64e06bc04c42d64a77834444.png"},{name:"便便",shortcut:"(bb)",md5:"a811e4d3e0bf451c4716401ac251d056.gif"},{name:"猪头",shortcut:"(zt)",md5:"8260d8878f182d0b3c6aa46d933fc216.png"},{name:"钱",shortcut:"(q)",md5:"d6b4a948530ed9dbb34e53e63dfc910.png"},{name:"Hi",shortcut:"(hi)",md5:"d98dc2c9584121f0a863c3d608cd3503.png"}],s={SEND:'<face n="${face}"/>',GET:'<img src="${img}" alt="${name}"/>'},u=/(<img[^>]+(:?(:?data-type="face"[^>]+alt=[^>]*)|(:?alt=[^>]+data-type="face"[^>]*))>)/gi,exports={};return exports.encode=function(e,t,a){var o,l=document.createElement("div"),c="";return e=e.replace(u,function(e,u){if(l.innerHTML=e,o=l.getElementsByTagName("img")[0],c=o.getAttribute("alt"),i(r,c)>=0)return a&&a.push(n(s.SEND,{face:c})),t;else return e})},exports.decode=function(i){var r;if(r=e(i.n))return n(s.GET,r);else return t.TEXT.FACE_UNSUPPORT},exports}),define("qiao-im-core/message/text",["require","../base/string","./meta/face","./meta/url","./meta/font","./meta/img","./meta/email","./meta/tel","./meta/qq","./meta/phone"],function(require){function e(e){var t=e.replace(/[\n\r]/g,"");return t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return v[n.toLowerCase()]?"\n":t?t:""}).replace(/<[^>]+>/g,"").replace(/(\n)+/g,"<br />"),t.replace(g,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")}function t(e){var t=b[e];return function(e,n,i){var r=t(e);if(!r)return void i();var a=n[n.length-1];if(a&&"text"===a.type)a.text+=r;else n.push({type:"text",text:r});i()}}function n(e,t){for(var n,i=t.length,o="",s=e,u=0;i>u;u++)n=t[u],e=n.encode(e,n.replaceStr,n.res),s=n.encode(s,""),o+=n.replaceStr+"|";e=r(e),o=o.substring(0,o.length-1);var l,c,d=new RegExp(o,"g"),f=[],p=s.split("");e=e.replace(d,function(e){for(u=0;i>u;u++)if(n=t[u],l=n.replaceStr,e===l&&(c=n.res[n.index]))f.push(n.res[n.index++])}),i=p.length;var m=[];for(u=0;i>u;u++){if(n=p[u])m.push(a(h,{text:r(n)}));if(n=f[u])m.push(f[u])}return e=m.join("")}function i(e,t){var n={encode:e,replaceStr:t,res:[],index:0};return n}var r=require("../base/string").encodeHTML,a=require("../base/string").format,o=require("./meta/face"),s=require("./meta/url"),u=require("./meta/font"),l=require("./meta/img"),c=require("./meta/email"),d=require("./meta/tel"),f=require("./meta/qq"),p=require("./meta/phone"),m="text",h='<text c="${text}"/>',g=new RegExp("​","g"),v={address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1},b={text:function(e){var t=r(e.c);return t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")},card:function(e){var t=r(e.c);return t.replace(/\r\n/gi,"<br/>").replace(/&amp;#xD;&amp;#xA;/gi,"<br/>").replace(/%2B/gi,"+")},url:s.decode,font:u.decode,face:o.decode,img:function(e){return"[图片]"},html:function(t){return e(t.c)}},exports={};exports.decoder={};for(var y in b)if(b.hasOwnProperty(y))exports.decoder[y]=t(y);return exports.encoder={text:function(e){var t=e.text,r=[];return r.push(i(o.encode,"\r")),r.push(i(l.encode,"")),r.push(i(s.encode,"")),r.push(i(p.encode,"\x00")),r.push(i(f.encode,"")),r.push(i(d.encode,"")),r.push(i(c.encode,"")),t=n(t,r),t=u.encode(e)+t}},exports.type=m,function(){return exports}}),define("qiao-im-core/im/config",["require"],function(require){var exports={};return exports.EVENT={CONNECT:"connect",SAY:"say",END:"end",UPLOAD:"getuploadserver",STARTUPLOAD:"startupload",SENDPREVIEW:"sendpreview",INPUTING:"inputing",ACCEPTFILE:"acceptfile",REJECTFILE:"rejectfile",CANCELFILE:"cancelfile",SENDFILE:"sendfile",SENDFILESTATUS:"sendfilestatus",TRANSFER:"transfer",HASHISTORY:"hashistory",FILEOK:"fileok",KICK:"kick",FORCEOVER:"forceover",ASSIGNTASK:"assigntask",TASKBEGIN:"taskbegin",CSOFFLINE:"csoffline",CSONLINE:"csonline",INFO:"info",BLOCK:"block",ERROR:"error",UPDATEDATA:"updateData",PEERFILE:"peerfile",STOP:"stop"},exports}),define("qiao-im-core/im/file",["require"],function(require){var e={},exports={};return exports.mapIn=function(t){e[t.fid]=t},exports.set=function(t,n,i){if(e[t])e[t][n]=i},exports.get=function(t,n){for(var i in e)if(i===t)if(!n)return e[i];else return e[i][n]},exports.map=e,exports}),define("qiao-im-core/im/bcs",["require","../common"],function(require){function e(e,t,r){var a={file:e.fid},o=i.URL_UPLOAD+e.type;n(i.SVR_TYPE,o,{data:a,onsuccess:t,onfail:r})}var t=require("../common"),n=t.request,i={SVR_TYPE:"ACCOUNT",URL_UPLOAD:"?module=im&controller=frontUrl&action=uploadUrl&m=",URL_DOWNLOAD:"?module=im&controller=frontUrl&action=downloadUrl"},exports={};return exports.getUploadPath=function(t,n,i){var r;e(t,function(e){e=e||{},r=e.data||{},r.fid=t.fid,n&&n(r)},function(e){e=e||{},r=e.data||{},r.fid=t.fid,i&&i(r)})},exports.download=function(e,t,r){var a={file:t,token:e};n(i.SVR_TYPE,i.URL_DOWNLOAD,{data:a,onsuccess:function(e){if(0===e.status)r&&r(e.data.url)}})},exports}),define("qiao-im-core/im/history",["require","../base/util","../base/emitter","../common","./chat/message"],function(require){function e(e){var t=e.content;if(t){var n=t.fields;if(n&&r.isArray(n))for(var i,a,o=n.length,s=0;o>s;s++)if(i=n[s],a=i.command,"message"===a)u[a](i,"history")}}function t(){var t={data:l,onsuccess:function(t){if(0===t.status)e(t.data||t);n(i)},onfail:function(){n(i)}};s(d.SVR_TYPE,d.URL_HIS,t)}var n,i,r=require("../base/util"),a=require("../base/emitter"),o=require("../common"),s=o.request,u=require("./chat/message"),l={sessionid:"",imuss:"",s:"",e:"",ucid:""},c={HAS:"hashistory"},d={SVR_TYPE:"ACCOUNT",URL_HIS:"?module=im&controller=web&action=getHistoryMsg"},exports={};return a.mixin(exports),exports.start=function(e,a,o){n=o,i=a;var s;if(a.histime)s={s:a.histime.s||"",e:a.histime.e||""};l=r.extendBySame(l,e,a,s),l.imuss=e.bid,t()},exports.EVENT=c,exports}),define("qiao-im-core/lang",[],function(){var exports={};return exports.TEXT={FILE_UNSUPPORT:"[文件]",FACE_UNSUPPORT:"[扩展头像]",IMG_UNSUPPORT:"[图片]",CFACE_UNSUPPORT:"[自定义头像]",CSNAME_DEFAULT:"在线客服",CSNAME_GROUP:"默认分组"},exports}),define("qiao-im-core/account",["require","./base/util","./common","./lang","./data"],function(require){var e=require("./base/util"),t=require("./common"),n=t.request,i=require("./lang"),r=require("./data"),a={SVR_TYPE:"ACCOUNT",GET_SUB_NAME:"?module=im&controller=mobile&action=getUserName",GET_GROUP_NAME:"?module=im&controller=mobile&action=getGroupName",GET_SITE_INFO:"?module=im&controller=mobile&action=corporation"},o={COMPANY:0,GROUP:1,SUBNAME:2,NICKNAME:3},s={siteid:"",ucid:"",csNameType:o.SUBNAME},exports={},u={};return exports.getGroupName=function(t,i,r,o){var u={};u[o?"subid":"groupid"]=t,n(a.SVR_TYPE,a.GET_GROUP_NAME,{data:e.extend(s,u),onsuccess:i,onfail:r})},exports.getSubName=function(t,i,r){n(a.SVR_TYPE,a.GET_SUB_NAME,{data:e.extend(s,{subid:t}),onsuccess:i,onfail:r})},exports.getShowSubNameById=function(e,t){function n(){if(l)clearTimeout(l);if(l=null,u[e]=c,t)t(c)}var a,l,c;if(s.csNameType===o.COMPANY)a=r.get("compname")||i.TEXT.CSNAME_DEFAULT;else if(s.csNameType===o.NICKNAME)a=r.get("nickname")||i.TEXT.CSNAME_DEFAULT;else if(u[e])a=u[e];else{c=s.csNameType===o.GROUP?i.TEXT.CSNAME_GROUP:i.TEXT.CSNAME_DEFAULT;var d=s.csNameType===o.GROUP?exports.getGroupName:exports.getSubName;return l=setTimeout(n,3e3),void d(e,function(n){n=n.data||"",n=n.replace(/^.*?:/,"");var i=u[e]=n.status?c:n;if(l)if(clearTimeout(l),t)t(i)},n,!0)}if(a&&t)t(a);return a},exports.getSiteInfo=function(e,t){n(a.SVR_TYPE,a.GET_SITE_INFO,{data:s,onsuccess:e,onfail:t})},exports.init=function(t){s=e.extendBySame(s,t)},exports}),define("qiao-im-core/im/send",["require","../base/util","../common","../message","./chat/message","../base/emitter","../data"],function(require){function e(e){if(r(e),clearTimeout(c),c=setTimeout(function(){exports.startResend()},y.TIME_RESEND),e.count++,e.count>=y.STOP_SEND_COUNT)u(e.time)}function t(e){var t=[].slice.call(arguments,1);return function(){e.apply(null,t)}}function n(e){u(e),exports.emit("statCommunicate")}function i(e){exports.emit("communicatefail",e)}function r(e){var r=e.time;p(y.SVR_TYPE,y.URL_SAY,{method:"post",data:e,onsuccess:t(n,r),onfail:t(i,e)}),exports.emit("communicatesend")}function a(e,t){var n=d.extend(w.ack,{to_sub:t||0,ackid:e});p(y.SVR_TYPE,y.URL_ACK,{method:"post",data:n})}function o(e){w.scenemsg.body=e,p(y.SVR_TYPE,y.URL_PREVIEW,{method:"post",data:w.scenemsg})}function s(){g.on(g.ACK,function(e,t){a(e,t)})}function u(e){var t=m.indexOf(_,e,"time");if(t>=0)m.removeAt(_,t);exports.startResend()}var l,c,d=require("../base/util"),f=require("../common"),p=f.request,m=f.array,h=require("../message"),g=require("./chat/message"),v=require("../base/emitter"),b=require("../data"),y={TIME_RESEND:2e4,TIME_PREVIEW:1500,SVR_TYPE:"IM",URL_SAY:"communicate",URL_PREVIEW:"scenemsg",URL_ACK:"msgack",URL_SENDFILE:"sendfile",URL_SENDFILEACK:"sendfileack",URL_CANCELFILE:"sendfilecancel",URL_SENDFILE_STATUS:"sendfilestatus",STOP_SEND_COUNT:3},w={send:{to:"",tid:"",body:"",time:"",msgtype:0,messageid:"",auto_subid:""},scenemsg:{to:"",body:""},ack:{from:"",to:"",to_sub:"",ackid:""},sendfile:{username:""},cancelFile:{username:""},sendFileStatus:{username:""},sendFileAck:{username:""}},exports={},x={SENDPREVIEW:"sendpreview"},_=[],T=!0;return v.mixin(exports),exports.say=function(e,t,n){var i=w.send;if(i.body=e,i.time=t.time||+new Date,i.messageid=b.get("seq"),i.msgtype=t.msgtype||0,i.count=0,void 0!==n.auto_subid)i.auto_subid=n.auto_subid;var a=d.clone(i);if(_.push(a),T)clearTimeout(c),c=setTimeout(function(){exports.startResend()},y.TIME_RESEND),r(a)},exports.setOnlineStatus=function(e){if("offline"===e)T=!1;else T=!0},exports.startResend=function(){if(_.length>0)e(_[0])},exports.updateModel=function(e){w.send=d.extend(w.send,e),w.scenemsg=d.extend(w.scenemsg,e)},exports.stopPreview=function(){clearInterval(l),l=null},exports.preview=function(){clearInterval(l),l=setInterval(function(){exports.emit(x.SENDPREVIEW,function(e){if(e)h.encode({type:"text",text:e},o)})},y.TIME_PREVIEW)},exports.sendfile=function(e){var t="00000000000000000000000000000000",n=e.name,i=e.size,r=d.extend({filepath:n,filesize:i,fid:e.fid},{filename:n.replace(/(.+)\.\w+$/,"$1"),filetype:"."+n.replace(/.+\.(\w+)$/,"$1"),filemd5:t,service:"cached",source:"bcs",role:"bridge_visitor",progress_notify:1,uri:"file/temp/"+t+"/"+i},w.sendfile);p(y.SVR_TYPE,y.URL_SENDFILE,{method:"post",data:r})},exports.cancelFile=function(e){var t=d.extend(e,w.cancelFile);p(y.SVR_TYPE,y.URL_CANCELFILE,{method:"post",data:t})},exports.sendFileAck=function(e,t){var n={type:t,service:"cached",role:"bridge_visitor",progress_notify:0,fid:e};d.extend(n,w.sendFileAck),p(y.SVR_TYPE,y.URL_SENDFILEACK,{method:"post",data:n})},exports.sendFileStatus=function(e){var t={fid:e.fid,size:e.size,uri:"",ready_for_download:e.finished?1:0,source:"bcs",token:e.token,bcsname:e.fid};t=d.extend(t,w.sendFileStatus),p(y.SVR_TYPE,y.URL_SENDFILE_STATUS,{method:"post",data:t})},exports.ackMsg=a,exports.EVENT=x,exports.init=function(e){w.send=d.extendBySame(w.send,e,{to:e.username}),w.scenemsg=d.extendBySame(w.scenemsg,e,{to:e.username}),w.ack=d.extendBySame(w.ack,e,{to:e.username}),w.sendfile=d.extendBySame(w.sendfile,e),w.sendFileStatus=d.extendBySame(w.sendFileStatus,e),w.cancelFile=d.extendBySame(w.cancelFile,e),w.sendFileAck=d.extendBySame(w.sendFileAck,e),s()},exports}),define("qiao-im-core/im/chat/message",["require","../../base/emitter","../../base/util","../../data"],function(require){var e=require("../../base/emitter"),t=require("../../base/util"),n=require("../../data"),i={WELCOME:1},r={PICK:"pick",NOTICE:"notice",ACK:"ack",HISMSG:"hismsg"},a={},o={},s={imuss:"",from:"",to:"",to_sub:"",ackid:""},exports={};return e.mixin(exports),exports.message=function(e,t){var s=n.get("peerid")+"";if("peer_message"!==e.command||e.peerid!==s){var u=e.time,l=e.time_server_ms||u,c=e.content,d=e.from_sub;if("peer_message"===e.command)d=e.from;var f=e.showOnceType;if(void 0===f){if(void 0===l)exports.emit(r.PICK,"message",c,l,d,t);else if(exports.emit(r.ACK,u,d),!o[u])if(o[u]=!0,"history"===t){if(d=e.from_alias||e.from,e.category===i.WELCOME)a[i.WELCOME]=!0;for(var p=0;p<c.length;p++)if("img"===c[p].type)return;exports.emit(r.HISMSG,c,l,d,t)}else exports.emit(r.PICK,"message",c,l,d,t)}else{if(f===i.WELCOME&&void 0!==l)exports.emit(r.ACK,u,e.from);if(!a[f])a[f]=!0,exports.emit(r.PICK,"message",c,l,d,t)}}},exports.init=function(e){s=t.extendBySame(s,e)},exports.EVENT=r,exports}),define("qiao-im-core/im/chat",["require","../base/util","../base/emitter","../common","./chat/message","../data"],function(require){function e(e,i,a){if(a===v){g=null,clearTimeout(b);var o=i.result;if("success"===e)t(i);else if("offline"===o||"kicked"===o)exports.emit(h.PICK,"stop");else n(i);if(!y)setTimeout(r,0);if("offline"===o||"kicked"===o)exports.emit(h.PICK,"restart")}}function t(e){var t=e.content;if(t){var n=t.fields;if(n&&c.isArray(n)){m.pick.ack=t.ack||m.pick.ack;for(var i,r,a=n.length,o=0;a>o;o++)if(i=n[o],r=i.command,"message"===r){if(i.showOnceType)f[r](i,"welcome");else f[r](i);if(e.acks)exports.emit(h.SENDACK,e.acks.split(";"))}else if("peer_message"===r)f.message(i,"peer_message");else{var s=r.replace(/notify$/,"");exports.emit(h.PICK,s,i.content)}}exports.emit(h.PICK,"success",{seq:p.get("seq"),ack:m.pick.ack})}}function n(e){e.result;if(exports.emit(h.PICK,"failure"),!y)exports.emit(h.PICK,"success",{seq:p.get("seq"),ack:m.pick.ack})}function i(){exports.emit(h.PICK,"timeout"),clearTimeout(b),o(),r()}function r(){if(!g)v++,g=d(w.SVR_TYPE,w.URL_PICK,{method:"post",data:m.pick,onsuccess:c.createHandle(e,v),onfail:c.createHandle(e,v)}),b=setTimeout(i,w.TIME_OUT_PICK)}function a(){f.on(f.EVENT.PICK,function(e,t,n,i,r){if("message"===e)exports.emit(h.PICK,"message",t,n,i,r)}),x=!0}function o(){if(g&&g.abort)g.abort();g=null,clearTimeout(b)}function s(e,t,n){m.pick=u.extendBySame(m.pick,e,{ack:t||""},{seq:n||0}),m.logout=u.extendBySame(m.logout,e)}var u=require("../base/util"),l=require("../base/emitter"),c=require("../common"),d=c.request,f=require("./chat/message"),p=require("../data"),m={pick:{ack:""},send:{to:"",tid:"",body:"",time:"",msgtype:0,messageid:""},logout:{}},h={PICK:"pick",SENDACK:"sendack",HISMSG:"hismsg"},g=null,v=0,b=null,y=!1,w={TIME_OUT_PICK:4e4,URL_PICK:"pick",URL_SAY:"communicate",URL_LOGOUT:"logout",SVR_TYPE:"IM"},x=!1,exports={};return l.mixin(exports),exports.start=function(e,t,n){s(e,t),f.init(m.send),!x&&a(),p.set("seq",n||""),p.set("session",e.session||""),r()},exports.logout=function(){c.img(w.SVR_TYPE,w.URL_LOGOUT,m.logout)},exports.restart=function(){y=!1},exports.stop=function(){y=!0,o(),clearTimeout(b)},exports.EVENT=h,exports}),define("qiao-im-core/im/connect",["require","../base/util","../base/emitter","../common","../base/string","../prevent/main"],function(require){function e(e){return!!/^[0-9]+$/.test(e)}function t(e){if(exports.emit(v.WELCOME,"success",e),e.content.tag)return void m.proxy(e.content);else return void u()}function n(e){exports.emit(v.WELCOME,"error",e)}function i(e,i){if("success"===e)t(i);else n(i)}function r(){var e={checkcode:m.getCheckCode(),jscode:m.getJsCode(!0)};e=p.objectToString(e),b.welcome.tag=e,h(g.SVR_TYPE,g.URL_WELCOME,{method:"post",data:b.welcome,onsuccess:f.createHandle(i),onfail:f.createHandle(i)})}function a(e){if(e.content.tag)return void m.proxy(e.content);else return void exports.emit(v.BRIDGEINIT,"success",e)}function o(e){var t=e&&e.result;switch(t){case"wait":exports.emit(v.BRIDGEINIT,"success",e);break;case"block":exports.emit(v.BRIDGEINIT,"block",e.content);break;default:exports.emit(v.BRIDGEINIT,"error",e&&e.content)}}function s(e,t){if("success"===e)a(t);else o(t)}function u(){h(g.SVR_TYPE,g.URL_BRIDGEINIT,{method:"post",data:b.bridgeinit,onsuccess:f.createHandle(s),onfail:f.createHandle(s)})}function l(t){var n=b.bridgeinit;if(n.sub=e(t.subid)?t.subid:n.sub,n.bridgetid=e(t.groupid)?t.groupid:n.bridgetid,e(n.sub))n.type=g.TYPE_SUB;else if(e(n.bridgetid))n.type=g.TYPE_GROUP;else n.type=g.TYPE_SITE,n.bridgetid=e(t.ptid)?t.ptid:n.bridgetid;n.fromsite=t.referrer||n.fromsite,n.srcword=t.word||n.srcword,n.region=t.from||n.region,n.insite=t.location||n.insite}var c=require("../base/util"),d=require("../base/emitter"),f=require("../common"),p=require("../base/string"),m=require("../prevent/main"),h=f.request,g={URL_WELCOME:"welcome",URL_BRIDGEINIT:"bridgeinit",SVR_TYPE:"IM",TYPE_SUB:0,TYPE_GROUP:1,TYPE_SITE:3,TYPE_CLIENT_PC:1,TYPE_CLIENT_MOBILE:2,TYPE_CLIENT_MINI:3},v={WELCOME:"welcome",BRIDGEINIT:"bridgeinit"},b={welcome:{source:0,anonym:!0,clienttype:c.isMobile?g.TYPE_CLIENT_MOBILE:g.TYPE_CLIENT_PC},bridgeinit:{type:g.TYPE_SITE,chattype:1,sub:"",bridgetid:"",username:"",fromsite:document.referrer,srcword:"",wordtype:0,wordid:0,region:"",insite:document.referrer,title:"",inittype:""}},exports={};return d.mixin(exports),exports.start=function(e){b.welcome=c.extendBySame(b.welcome,e),b.bridgeinit=c.extendBySame(b.bridgeinit,e),l(e),r()},exports.EVENT=v,exports}),define("qiao-im-core/im",["require","./base/Storage","./base/emitter","./base/util","./im/connect","./im/chat","./im/send","./account","./message","./im/history","./data","./im/bcs","./im/file","./common","./im/chat/message","./im/config","./message/text","./message/voice"],function(require){function e(e){D=b.extend(D,j,L.get(),e)}function t(e){D=b.extend(D,e);for(var t in j)if(j.hasOwnProperty(t))L.set(t,D[t])}function n(e,t){D[e]=t,L.set(e,t)}function i(){exports.emit(N.UPDATEDATA,{ls:D.ls,fs:D.fs,lc:D.lc})}function r(){n("lc",+D.lc+1),i()}function a(e){var t,n=b.getCookie(R.COOKIE_ACK);if(n)if(t=n.split("|")[1],(new Date).getTime()-t<R.COOKIE_ACK_TIME)n=n.split("|")[0];w.start(D,e.pickseq||n||"",e.seq),exports.emit(N.CONNECT,e)}function o(e,t){if(!t)u(e);if(e.hismsg&&e.hismsg===R.HAS_HIS_MSG)E.start(D,e,a);else a(e)}function s(e){if(P=R.STATUS_WAIT,e&&e.length>0)T.decode(e,function(e){if(e=e[0],e&&"text"===e.type)exports.emit(N.INFO,e.text,"wait")})}function u(e){var n=e.subid;if(void 0!==n&&n!==D.subid){var r=void 0===e.tid?D.tid:e.tid;t({subid:n,tid:r,ls:n,fs:""===D.fs?e.subid||0:D.fs}),i(),S.set("subid",n)}}function l(e,t,n,i){if(!t)t=(new Date).getTime();if("history"===i)T.decode(e,function(e){exports.emit("message",e,n,t,i)});else if("peer_message"===i){T.decode(e,function(e){exports.emit("message",e,n,t,i)});for(var r=0;r<e.length;r++)if("img"===e[r].type)!function(){var t=decodeURIComponent(e[r].token),n=e[r].bcsname;C.download(t,n,function(e){exports.emit(N.FILEOK,{url:e,name:I.get(n,"name"),token:t,fid:n,type:"img"})})}()}else _.getShowSubNameById(n,function(n){T.decode(e,function(e){exports.emit("message",e,n,t,i)})})}function c(){var e=Array.prototype.slice.call(arguments),t=F[e[0]];if(t)t.apply(null,e.slice(1))}function d(){y.on(y.EVENT.WELCOME,function(e,t){if("success"===e){if(t.content.tag)return void(O=!1);S.set("session",t.content.session),n("session",t.content.session),n("keep",1e3*t.content.keep||R.CHAT_TIME_OUT)}else O=!1,exports.emit(N.ERROR,k.CONNECT,t||R.ERROR_INIT_WELCOME)}),y.on(y.EVENT.BRIDGEINIT,function(e,t){if("success"===e){if(A=!0,o(t.content),t.result&&"wait"===t.result.toLowerCase())s(t.content.autoResponse);x.updateModel({tid:t.content.tid}),r()}else if("block"===e)m(),exports.emit(N.ERROR,k.CONNECT,t);else exports.emit(N.ERROR,k.CONNECT,t)}),M.on(M.EVENT.HISMSG,l),M.on(M.EVENT.ACK,x.ackMsg),w.on(w.EVENT.PICK,c),w.on(w.EVENT.SENDACK,x.success),x.on(x.EVENT.SENDPREVIEW,function(e){exports.emit(N.SENDPREVIEW,e)}),E.on(E.EVENT.HAS,function(e){exports.emit(N.HASHISTORY,e)})}function f(){t({session:""}),O=!1}function p(){L.clear()}function m(e){w.stop(),f()}var h,g=require("./base/Storage"),v=require("./base/emitter"),b=require("./base/util"),y=require("./im/connect"),w=require("./im/chat"),x=require("./im/send"),_=require("./account"),T=require("./message"),E=require("./im/history"),S=require("./data"),C=require("./im/bcs"),I=require("./im/file"),L=(require("./common"),new g("im")),M=require("./im/chat/message"),N=require("./im/config").EVENT,k={CONNECT:"connect",OFFLINE:"offline",UPLOAD:"getuploadserver"},R={STATUS_NORMAL:0,STATUS_WAIT:1,TIME_OFFLINE:13e4,ERROR_INIT_WELCOME:1,ERROR_INIT_BRIDGE:2,OVER_TYPE_KICK:1,OVER_TYPE_FORCE:2,HAS_HIS_MSG:1,CS_STATUS_WAIT:3,CHAT_TIME_OUT:12e4,COOKIE_ACK:"QIAO_COOKIE_ACK",COOKIE_ACK_TIME:3e4,STOP_TYPE_KICK:"kick",STOP_TYPE_FORCE:"force"},D={inittype:""},O=!1,A=!1,P=R.STATUS_NORMAL,j={imuss:"",bid:"",session:"",ack:"",seq:"",tid:"",sub:"",inittype:"",csName:"",chatid:"",lasttime:0,keep:0},F={},exports={};return F.success=function(e){if(b.extend(e,{lasttime:(new Date).getTime()}),t(e),h)clearTimeout(h),h=null},F.scenefocus=function(){if(!D.inittype)x.preview()},F.sceneunfocus=function(){x.stopPreview()},F.stop=function(){m()},F.restart=function(){w.restart(),exports.emit(N.ERROR,k.OFFLINE)},F.scenemsg=function(){exports.emit(N.INPUTING)},F.message=function(e,t,n,i){l(e,t,n,i),exports.emit("statPickMessage")},F.sendfileack=function(e){if(e){var t=e.type;if("agree"===t)exports.emit(N.ACCEPTFILE,{
fid:e.fid,source:e.source}),C.getUploadPath({fid:e.fid,type:"POST"},function(e){exports.emit(N.STARTUPLOAD,e)},function(e){exports.emit(N.ERROR,k.UPLOAD)});if("reject"===t)exports.emit(N.REJECTFILE,{fid:e.fid})}},F.sendfilecancel=function(e){exports.emit(N.CANCELFILE,e)},F.sendfile=function(e){var t={fid:e.fid,name:e.filename,type:e.filetype,size:e.filesize,md5:e.filemd5,uri:e.uri};I.mapIn(t),exports.emit(N.SENDFILE,t)},F.sendfilestatus=function(e){var t=decodeURIComponent(e.token),n=e.bcsname||e.fid;if(e.ready_for_download)C.download(t,n,function(i){exports.emit(N.FILEOK,{url:i,name:I.get(n,"name"),token:t,fid:n,type:e.type||"file"})});exports.emit(N.SENDFILESTATUS,{fid:n,size:e.size,name:I.get(n,"name"),type:e.type||"file"})},F.peer_sendfileack=function(e){if(e){var t=S.get("peerid")+"";if(e.peerid===t)F.sendfileack(e);else exports.emit(N.PEERFILE,{fid:e.fid,type:e.type})}},F.communicatetransfer=function(e){u(e),exports.emit(N.TRANSFER,e),exports.emit("statPickTransfer")},F.kick=function(e){if(m(),e&&+e.type===R.OVER_TYPE_KICK)exports.emit(N.STOP,R.STOP_TYPE_KICK);else if(e&&+e.type===R.OVER_TYPE_FORCE)exports.emit(N.STOP,R.STOP_TYPE_FORCE);exports.emit("statPickKick")},F.assigntaskack=function(e){if(u(e),P===R.STATUS_WAIT)exports.emit(N.CSONLINE,e.from||"")},F.taskbegin=function(e){u(e),n("chatid",e.sessionid),S.set("sessionid",e.sessionid),exports.emit("statTaskBegin",{mainId:S.get("mainId"),siteId:S.get("SITE_ID"),bid:S.get("bid"),subId:S.get("subid"),chatId:S.get("sessionid")})},F.offline=function(e){exports.emit(N.CSOFFLINE,e),exports.emit("statPickOffline")},v.mixin(exports),exports.setChatStatus=function(e){if(e===R.CS_STATUS_WAIT)P=R.STATUS_WAIT;else P=R.STATUS_NORMAL},exports.start=function(e){if(D=b.extend(D,e),!O)O=!0,y.start(D)},exports.say=function(e){var t={};if(D.inittype)t.auto_subid=D.subid;T.encode(e,function(n){x.say(n,e,t)})},exports.rejectFile=function(e){x.sendFileAck(e,"reject")},exports.acceptFile=function(e){x.sendFileAck(e,"agree")},exports.sendFile=function(e){x.sendfile(e)},exports.sendFileStatus=function(e){x.sendFileStatus(e)},exports.upload=function(e,t){var n=e.type;n=n?n.toUpperCase():"POST",C.getUploadPath(e,t)},exports.download=function(e,t,n){e=decodeURIComponent(e),C.download(e,t,n)},exports.end=function(e){if(f(),e&&A){if(L.get("ack"))b.setCookie(R.COOKIE_ACK,L.get("ack")+"|"+(new Date).getTime());p(),w.logout()}exports.emit(N.END)},exports.init=function(t){e(t),d(),x.init(D),T.plugin(require("./message/text")()),T.plugin(require("./message/voice")())},exports.cancelFile=function(e){x.cancelFile(e)},exports.EVENT=N,exports.hasConnented=function(){return O},exports}),define("qiao-im-core/rcv/leave",["require","../base/util","../base/emitter","../common"],function(require){function e(){i.img(r.SVR_TYPE,r.URL_LEAVE,a)}var t=require("../base/util"),n=require("../base/emitter"),i=require("../common"),r={URL_LEAVE:"Leave.php",SVR_TYPE:"RCV"},a={},o={},exports={};return n.mixin(exports),exports.start=function(n,i){o=t.extend(o,i),a=t.extendBySame(a,n),e()},exports}),define("qiao-im-core/rcv/refresh",["require","../base/emitter","../base/util","../prevent/main","../common"],function(require){function e(e){if(0===e.saved)return void clearInterval(u);else return r.prevent(e),void exports.emit("refresh",e)}function t(){a(o.SVR_TYPE,o.URL_REFRESH,{data:l,onsuccess:e})}var n=require("../base/emitter"),i=require("../base/util"),r=require("../prevent/main"),a=require("../common").request,o={URL_REFRESH:"Refresh.php",SVR_TYPE:"RCV"},s=15e3,u=null,l={},exports={};return n.mixin(exports),exports.start=function(e){l=i.extendBySame(l,e),u=setInterval(t,s)},exports}),define("qiao-im-core/rcv/enter",["require","../base/util","../base/emitter","../prevent/main","../prevent/config","../common"],function(require){function e(){var e=(new Date).getTimezoneOffset(),t=parseInt(e/60,10),n=e%60,i="-";if(0>t||0>n)if(i="+",t=-t,0>n)n=-n;return t+="",n+="","UTC"+i+t+":"+n}function t(){var t=window.navigator,n=window.screen,i={};return i.lang=t.language||t.systemLanguage,i.rsl=n.width+"*"+n.height,i.tz=e(),i.cbit=n.colorDepth,i}function n(e){if(e.tag||1===e.saved)exports.emit("enter",e)}function i(){exports.emit("enterfail")}function r(){s(u.SVR_TYPE,u.URL_ENTER,{data:l,onsuccess:n,onfail:i})}var a=require("../base/util"),o=require("../base/emitter"),s=(require("../prevent/main"),require("../prevent/config"),require("../common").request),u={URL_ENTER:"Enter.php",SVR_TYPE:"RCV",TYPE_VIS_PC:1,TYPE_VIS_MOBILE:2,TYPE_VIS_MINI:3},l={referrer:document.referrer,ex:"",iswebim:1,word:"",coding:"",bdclickid:"",title:"",inurl:"",vis_type:a.isMobile?u.TYPE_VIS_MOBILE:u.TYPE_VIS_PC,lang:"",rsl:"",tz:"",cbit:"",fromSite:"",expand:""},exports={};return o.mixin(exports),exports.start=function(e){l=a.extendBySame(l,e,t()),r()},exports}),define("qiao-im-core/rcv",["require","./base/util","./base/Storage","./base/emitter","./rcv/enter","./rcv/refresh","./rcv/leave"],function(require){function e(e){f=r(f,e),f.lt=e.ltime||f.lt,f.ft=e.ftime||f.ft;for(var t in p)if(p.hasOwnProperty(t))s.set(t,f[t])}function t(e){f=r(f,s.get(),e)}function n(t){e(t),l.start(f),exports.emit(d.ENTER,f)}function i(e){exports.emit(d.REFRESH,e)}var r=require("./base/util").extend,a=require("./base/Storage"),o=require("./base/emitter"),s=new a("rcv"),u=require("./rcv/enter"),l=require("./rcv/refresh"),c=require("./rcv/leave"),d={ENTER:"rcv:enter",REFRESH:"rcv:refresh"},f={lt:0,ft:0,lv:0,lvp:0,peerid:""},p={bid:"",lt:0,ft:0,lv:0,lvp:0,peerid:""},exports={};return o.mixin(exports),exports.start=function(){u.start(f)},exports.leave=function(){c.start(f)},exports.init=function(e){t(e),u.on("enter",n),l.on("refresh",i)},exports.EVENT=d,exports}),define("qiao-im-core/base/net/jsonp",["require"],function(require){"use strict";function e(e,i){var s=a(),p=null,m=i.timeout||null,h=i.callbackKey||d,g=s,v=i.data||{};v.t=(new Date).getTime();var b=i.charset||f,y=function(e){i.onsuccess&&i.onsuccess(e),n(p),r(g)},w=function(){i.onfail&&i.onfail(),n(p),r(g)},x=o({url:e+t(e,v,h,g),charset:b,id:s});if(l[s]=u[s]=function(){try{y.apply(null,arguments)}catch(e){w.apply(null,arguments)}},c[s]=function(){w.apply(null,arguments)},m)p=setTimeout(function(){p=null,x.abort(),w.call(null)},m);return x.send(),x}function t(e,t,n,i){var r={}.toString.call(t),a="?";if(e.indexOf("?")>-1)a="&";var o=a+n+"="+i;if("[object Object]"===r)for(var s in t)if(t.hasOwnProperty(s))o+="&"+s+"="+encodeURIComponent(t[s]);return o}function n(e){if(e)clearTimeout(e),e=null}function i(e){if(u[e])u[e]=p(e),l[e]=null,delete l[e]}function r(e){try{l[e]=null,u[e]=null,delete l[e],delete u[e]}catch(t){}}function a(){var e="cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function o(e){var t,n=s.head||s.getElementsByTagName("head")&&s.getElementsByTagName("head")[0]||s.body;return{send:function(){t=s.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){if(n===!0||!t.readyState||/loaded|complete/.test(t.readyState)){if(t.onload=t.onreadystatechange=null,t.parentNode)t.parentNode.removeChild(t);if(t=null,n===!0)i(e.id)}},t.onerror=function(){if(t.parentNode)t.parentNode.removeChild(t);if(c[t.id])c[t.id].call(null);t=null},n.insertBefore(t,n.firstChild)},abort:function(){if(t)t.onload(!0)}}}var s=document,u=window,l={},c={},d="callback",f="utf-8",p=function(e){return function(){try{u[e]=null,delete u[e]}catch(t){}}};return{request:e}}),define("qiao-im-core/data",["require","./base/util"],function(require){var e=require("./base/util"),t={bid:"",peerid:"",siteid:"",mainId:"",username:"",ucid:"",seq:0,session:"",subid:"",sessionid:"",SITE_ID:"",tag:"",compname:"",nickname:"",crossdomain:!1,startTime:0,inited:0,type:1},n={imuss:"",peerid:"",siteid:"",ucid:"",seq:0,session:"",tag:""},i={bid:"",peerid:"",siteid:"",ucid:"",tag:""},exports={};return exports.IM=function(){return e.extendBySame(n,t,{imuss:t.bid})},exports.RCV=function(){return e.extendBySame(i,t)},exports.ACCOUNT=function(){return{siteid:t.siteid,ucid:t.ucid,tag:t.tag}},exports.set=function(e,n){if(t.hasOwnProperty(e))t[e]=n},exports.get=function(e){if(!e)return t;else return t[e]},exports.init=function(n){t=e.extendBySame(t,n)},exports}),define("qiao-im-core/common",["require","./base/net/ajax","./base/net/imgnet","./data","./base/util","./base/net/jsonp"],function(require){function e(e,t){if(t=a.clone(r[e](),t),"IM"===e)r.set("seq",t.seq+1),t.session=r.get("session");return t}function t(t,n,i){var r=i.data,a=i.onfail,s=i.onsuccess;if("function"==typeof r)a=s,s=r,r=null;i.data=e(t,r);var c=u+l[t]+n;return o.request(c,i)}var n=require("./base/net/ajax"),i=require("./base/net/imgnet"),r=require("./data"),a=require("./base/util"),o=require("./base/net/jsonp"),s=Object.prototype.toString,u="http://p.qiao.baidu.com",l={IM:"/",RCV:"/",ACCOUNT:"/im/"},exports={};exports.createHandle=function(e){var t=[].slice.call(arguments,1);return function(){var n=[[].slice.call(arguments)[0]].concat(t);if(!n||!n[0])return void e("fail");var i=n[0],r=i.result;if(r&&"ok"===r.toLowerCase())n=["success"].concat(n),e&&e.apply(null,n);else{if(n=["fail"].concat(n),!r)i.result="error";e&&e.apply(null,n)}}},exports.array={indexOf:function(e,t,n){var i,r,a=e.length;for(i=0;a>i;i++){if(n)r=e[i][n];else r=e[i];if(i in e&&r===t)return i}return-1},removeAt:function(e,t){return e.splice(t,1)[0]}};var c={post:function(t,i,r){var a=e(t,r.data),o=l[t]+i;return n.post(o,a,r.onsuccess,r.onfail)},get:function(t,i,r){var a=r.data,o=r.onfail,s=r.onsuccess;if("function"==typeof a)o=s,s=a,a=null;a=e(t,a);var u=l[t]+i;return n.get(u,a,s,o)}};return exports.request=function(e,n,i){var a=r.get("crossdomain");if(a)return t(e,n,i);else{var o=i.method||"get";return c[o](e,n,i)}},exports.img=function(t,n,r,a,o){if("function"==typeof r)o=a,a=r,r=null;r=e(t,r);var s=l[t]+n;i.request(s,r,a,o)},exports.isArray=function(e){return"[object Array]"===s.call(e)},exports.URL=l,exports}),define("qiao-im-core/prevent/config",["require","../base/string","../base/emitter"],function(require){function e(){var e={jscode:i};return t.objectToString(e)}var t=require("../base/string"),n=require("../base/emitter"),i="",r="",exports={};return n.mixin(exports),exports.anti={ANTI_FORBID:1,ANTI_JSCODE:2,ANTI_SECOND:3,ANTI_AUTHCODE:4},exports.tag={antiJscode:!1,antiSecond:!1,antiAuthcode:!1},exports.url={checkUrl:"atverifycode",getUrl:"atgetcode"},exports.setJsCode=function(e){try{var t="return "+e,n=new Function(t),r=n();if("function"==typeof r)i=r();else i=r}catch(a){i=e}exports.emit("setTag")},exports.setAuthCode=function(e){r=e||""},exports.getAuthCode=function(){return r},exports.getJsCode=function(t){if(t)return i;else return e()},exports}),define("qiao-im-core/prevent/main",["require","./config","../common","../message","../base/emitter","../data"],function(require){function e(e){exports.emit("getAuth",e),u=e.body.codeid}function t(e){exports.emit("verifyAuth",e)}var n,i=require("./config"),r=require("../common").request,a=(require("../message"),require("../base/emitter")),o=require("../data"),s={SVR_TYPE:"RCV",url:i.url},u="",exports={};return a.mixin(exports),exports.prevent=function(e,t){if(e.tag)switch(e.tag.op){case i.anti.ANTI_JSCODE:if(i.setJsCode(e.tag.val),i.tag.antiJscode=!0,o.set("tag",n()),t)t();break;case i.anti.ANTI_SECOND:i.tag.antiSecond=!0;break;case i.anti.ANTI_AUTHCODE:if(i.tag.antiAuthcode=!0,e.tag.val)i.url.checkUrl=e.tag.val.checkurl,i.url.getUrl=e.tag.val.geturl}},exports.proxy=function(e){switch(e.tag.op){case i.anti.ANTI_AUTHCODE:exports.emit("authCode",e);break;case i.anti.ANTI_SECOND:exports.emit("secondConfirm",e);break;case i.anti.ANTI_FORBID:var t="网络繁忙,请您重试";exports.emit("info",t,"forbid")}},a.mixin(exports),exports.getAuthCode=function(){var t={timestamp:(new Date).valueOf()};r(s.SVR_TYPE,s.url.getUrl,{data:t,onsuccess:e})},exports.verifyCode=function(e){i.setAuthCode(e);var n={bid:o.get("bid")||"",val:e,timestamp:(new Date).valueOf(),codeId:u};r(s.SVR_TYPE,s.url.checkUrl,{data:n,onsuccess:t})},exports.getJsCode=n=function(e){return i.getJsCode(e)},exports.getCheckCode=function(){return i.getAuthCode()},exports.init=function(){i.on("setTag",function(){o.set("tag",n())})},exports}),define("qiao-im-core/log",["require","./base/util","./base/net/imgnet"],function(require){var e=require("./base/util"),t=require("./base/net/imgnet"),n={siteid:"",bid:"",peerid:"",ucid:""},i="",exports={};return exports.send=function(r){var a=e.clone(n);a=e.extend(a,r),t.request(i,a)},exports.init=function(t){n=e.extendBySame(n,t)},exports}),define("qiao-im-core/message",["require"],function(require){function e(e){for(var n,i=e.length,r=0;i>r;r++)if(n=e[r],"text"===n.type)n.text=n.text.replace(t,"")+"</div>"}var t=/<\/div>/i,n={},i={},exports={};return exports.encode=function(e,t){var i,r=n[e.type];if(r)i=r(e),t&&t("<msg>"+i+"</msg>")},exports.decode=function(t,n){function r(){var s=t[a++];if(!s)return e(o),void n(o);if("url"===s.type&&"map"===s.t&&i.map)s.type="map";var u=i[s.type];if(!u)return void r();else return void u(s,o,r)}var a=0,o=[];r()},exports.plugin=function(e){var t=e.encoder;if(t)for(var r in t)if(t.hasOwnProperty(r))n[r]=t[r];var a=e.decoder;if(a)for(r in a)if(a.hasOwnProperty(r))i[r]=a[r]},exports}),define("qiao-im-core/base/string",["require"],function(require){var e={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"},exports={};return exports.encodeHTML=function(e){if(!e)return"";else return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(t){if(!t)return"";else return(t+"").replace(/\&([^;]+);/g,function(t,n){var i;if(n in e)return e[n];else if(i=n.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(i[1],16));else if(i=n.match(/^#(\d+)$/))return String.fromCharCode(parseInt(i[1],10));return t})},exports.format=function(e,t){if(!e)return"";if(null==t)return e;var n="function"==typeof t?t:function(e){var n=t[e];return null==n?"":n};return(e+"").replace(/\$\{(.+?)\}/g,function(e,t){return n(t)})},exports.objectToString=function(e){var t=[],n=function(e){if("object"==typeof e&&null!==e)return this.objectToString(e);else return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var i in e)t.push('"'+i+'":'+n(e[i]));return"{"+t.join(",")+"}"},exports}),define("qiao-im-core/base/Storage",[],function(){function e(e){this.id=e.toUpperCase()}var t,n=window.localStorage,i=window,r=i.document,a="QIAOUSERDATACHAT"+location.hostname,o=function(){function e(e){return e.replace(o,"___")}var t,n=null,i=365,o=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=a+(e.siteid||""),i=e.expires||i},setup:function(){if(!n)try{n=r.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),r.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(r,a){r=e(r);var o=this,s=new Date;if(o.setup())return s.setDate(s.getDate()+i),n.expires=s.toUTCString(),n.load(t),n.setAttribute(r,a),n.save(t),a;else return void 0},getItem:function(i){i=e(i);var r=this;if(r.setup())return n.load(t),n.getAttribute(i)},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}();return e.init=function(e){var i=e.siteid;if(!t)t="BDBG_IM_"+i+"_";if(!window.localStorage)n=o,n.build({siteid:i})},e.clear=function(){n.clear()},e.prototype.key=function(){return t+this.id},e.prototype.get=function(e){var t;try{t=JSON.parse(n.getItem(this.key())||"{}")}catch(i){t={}}if(e)return t[e];else return t},e.prototype.clear=function(){try{try{n.setItem(this.key(),JSON.stringify({}))}catch(e){n.clear()}}catch(t){}},e.prototype.set=function(e,t){var i=this.get();i[e]=t;try{try{n.setItem(this.key(),JSON.stringify(i))}catch(r){n.clear(),n.setItem(this.key(),JSON.stringify(i))}}catch(a){}},e}),define("qiao-im-core/base/net/imgnet",["require","../util"],function(require){var e=require("../util"),t=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}(),exports={};return exports.request=function(n,i,r,a){if("function"==typeof i)a=r,r=i,i=null;(i=i||{}).t=t(),n+=(n.indexOf("?")>-1?"&":"?")+e.jsonToQuery(i);var o=new Image;o.onload=function(){o.onload=null,o.onerror=null,o=null,r&&r()},o.onerror=function(){o.onload=null,o.onerror=null,o=null,a&&a()},o.src=n},exports}),define("qiao-im-core/base/emitter",[],function(){function e(){}var t=e.prototype;return t._getEvents=function(){if(!this._events)this._events={};return this._events},t._getMaxListeners=function(){if(isNaN(this.maxListeners))this.maxListeners=10;return this.maxListeners},t.on=function(e,t){var n=this._getEvents(),i=this._getMaxListeners();n[e]=n[e]||[];var r=n[e].length;if(r>=i&&0!==i)throw new RangeError("Warning: possible Emitter memory leak detected. "+r+" listeners added.");return n[e].push(t),this},t.once=function(e,t){function n(){i.off(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},t.off=function(e,t){var n=this._getEvents();if(0===arguments.length)return this._events={},this;var i=n[e];if(!i)return this;if(1===arguments.length)return delete n[e],this;for(var r,a=0;a<i.length;a++)if(r=i[a],r===t||r.listener===t){i.splice(a,1);break}return this},t.emit=function(e){for(var t=this._getEvents(),n=t[e],i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);if(n)for(n=n.slice(0),r=0;r<n.length;r++)n[r].apply(this,i);return this},t.listeners=function(e){var t=this._getEvents();return t[e]||[]},t.setMaxListeners=function(e){return this.maxListeners=e,this},e.mixin=function(e){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e},e}),define("qiao-im-core/base/util",["require"],function(require){var exports={};exports.extend=function(e,t){for(var n=arguments.length,i=1;n>i;i++)if(t=arguments[i]){for(var r in t)if(t.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.extendBySame=function(e,t){for(var n=1,i=arguments.length;i>n;n++)if(t=arguments[n]){for(var r in t)if(t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&void 0!==t[r])e[r]=t[r]}else;return e},exports.createUUID=function(){for(var e="0123456789ABCDEF",t=[],n=0;32>n;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);t[12]="4",t[16]=e.substr(3&t[16]|8,1);var i=t.join("");return i=i.toLowerCase(),i=i.replace(/^(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})$/,"$1-$2-$3-$4-$5")},exports.jsonToQuery=function(e){var t,n,i=[];for(var r in e)if(e.hasOwnProperty(r)){if(t=e[r],!exports.isArray(t))t=[t];n=t.length;for(var a=0;n>a;a++)i.push(r+"="+encodeURIComponent(t[a]))}return i.join("&")};var e=Object.prototype.toString;return exports.isObject=function(t){return"[object Object]"===e.call(t)},exports.isString=function(t){return"[object String]"===e.call(t)},exports.isArray=function(t){return"[object Array]"===e.call(t)},exports.clone=function(e){for(var t={},n=0,i=arguments.length;i>n;n++)if(e=arguments[n]){for(var r in e)if(e.hasOwnProperty(r)&&void 0!==e[r])t[r]=e[r]}else;return t},exports.setCookie=function(e,t,n){var i=e+"="+escape(t),r=0;if(n)r=new Date,r.setTime(r.getTime()+1e3*n);i+=(r?";expires="+r.toGMTString():"")+";path=/;",document.cookie=i},exports.getCookie=function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);if(null!=n)return unescape(n[2]);else return null},exports.isMobile=function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window}(),exports}),define("qiao-im-core/base/net/ajax",["require","../util"],function(require){function e(){}function t(n,i){function r(){if(4===l.readyState){try{var t=l.status}catch(n){return void o("failure")}if(o(t),t>=200&&300>t||304===t||1223===t)o("success");else o("failure");window.setTimeout(function(){if(l.onreadystatechange=e,d)l=null},0)}}function a(){if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(window.XMLHttpRequest)return new XMLHttpRequest;else return void 0}function o(e){e="on"+e;var n=v[e],r=t[e];if(n){if(s)clearTimeout(s);if("onsuccess"!==e)n(l);else{try{var a=l.responseText;a=new Function("return ("+a+")")()}catch(o){return n(l)}i.onsuccess(a)}}else if(r){if("onsuccess"===e)return;r(l)}}i=i||{};var s,u,l,c=i.data||"",d=!(i.async===!1),f=i.username||"",p=i.password||"",m=(i.method||"GET").toUpperCase(),h=i.headers||{},g=i.timeout||0,v={};for(u in i)v[u]=i[u];if(0!==n.indexOf("http"))h["X-Requested-With"]="XMLHttpRequest";try{if(l=a(),"GET"===m){if(c)n+=(n.indexOf("?")>=0?"&":"?")+c,c=null;if(i.noCache)n+=(n.indexOf("?")>=0?"&":"?")+"b"+ +new Date+"=1"}if(f)l.open(m,n,d,f,p);else l.open(m,n,d);if(d)l.onreadystatechange=r;if("POST"===m)h["Content-Type"]=h["Content-Type"]||"application/x-www-form-urlencoded",l.setRequestHeader("Content-Type",h["Content-Type"]),delete h["Content-Type"];for(u in h)if(h.hasOwnProperty(u))l.setRequestHeader(u,h[u]);if(o("beforerequest"),g)s=setTimeout(function(){l.onreadystatechange=e,l.abort(),o("timeout")},g);if(l.send(c),!d)r()}catch(b){o("failure")}return l}function n(){return(new Date).getTime().toString(36)}function i(i,a){var s=a.onsuccess||e,u=a.onfailure||e;a.onsuccess=s,a.onfailure=u;var l=a.data||{};if(a.method===o)i+=(i.indexOf("?")>=0?"&":"?")+"_t="+n(),a.data=r(l);else l._t=n(),i+=(i.indexOf("?")>=0?"&":"?")+r(l),a.data=null;return t(i,a)}var r=require("../util").jsonToQuery,a="GET",o="POST",exports={};return exports.post=function(e,t,n,r){return i(e,{method:o,data:t,onsuccess:n,onfailure:r})},exports.get=function(e,t,n,r){return i(e,{method:a,data:t,onsuccess:n,onfailure:r})},exports}),define("qiao-im-core/base/main",["require","./net/ajax","./emitter","./net/imgnet","./Storage","./string","./util"],function(require){function e(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];return e}var exports={};return e(exports,require("./net/ajax")),e(exports,require("./emitter")),e(exports,require("./net/imgnet")),e(exports,require("./Storage")),e(exports,require("./string")),e(exports,require("./util")),exports}),define("qiao-im-core",["qiao-im-core/main"],function(e){return e}),define("qiao-im-core/main",["require","./base/main","./message","./log","./base/util","./base/Storage","./base/emitter","./prevent/main","./prevent/config","./rcv","./im","./account","./data","./hm","./log/chat","./message/meta/face","./message/meta/font","./message/meta/url"],function(require){function e(){c.on("rcv:enter",function(e){if(e&&e.bid)g.bid=e.bid,p.set("bid",g.bid),g.peerid=e.peerid,p.set("peerid",g.peerid);if(e.tag)if(e.tag.op===l.anti.ANTI_JSCODE&&!e.group)return void u.prevent(e,function(){c.start()});else u.prevent(e);if(l.tag.antiAuthcode)exports.emit("authCode");else if(l.tag.antiSecond)exports.emit("secondConfirm");else exports.emit("init")}),c.on("rcv:refresh",function(e){d.setChatStatus(e.cstatus)}),d.on(d.EVENT.ERROR,function(e){if(e===v.OFFLINE)exports.resetStartTime(),c.start()})}function t(t,n){p.init(a.clone(t,n)),o.init({siteid:t.siteid}),c.init(t),d.init(t),f.init(t),r.init(),e(),m.init(),u.init(),h.init()}var n=require("./base/main"),i=require("./message"),r=require("./log"),a=require("./base/util"),o=require("./base/Storage"),s=require("./base/emitter"),u=require("./prevent/main"),l=require("./prevent/config"),c=require("./rcv"),d=require("./im"),f=require("./account"),p=require("./data"),m=require("./hm"),h=require("./log/chat"),g={bid:"",peerid:"",siteid:"",mainId:"",username:"",ucid:""},v={CONNECT:"connect",OFFLINE:"offline"},exports={};return s.mixin(exports),exports.face={},exports.font={},exports.url={},a.extend(exports.face,require("./message/meta/face")),a.extend(exports.font,require("./message/meta/font")),a.extend(exports.url,require("./message/meta/url")),exports.send=function(e){if(a.isString(e))e={type:"text",text:e};d.say(e)},exports.sendFile=function(e){d.sendFile(e)},exports.sendFileStatus=function(e){d.sendFileStatus(e)},exports.rejectFile=function(e){d.rejectFile(e)},exports.acceptFile=function(e){d.acceptFile(e)},exports.cancelFile=function(e){d.cancelFile(e)},exports.upload=function(e,t){d.upload(e,t)},exports.download=function(e,t,n){d.download(e,t,n)},exports.addPlugin=function(e){if(e)i.plugin(e.call(null,exports,n))},exports.getSiteInfo=function(e){f.getSiteInfo(function(t){e(t)})},exports.disconnect=function(e){d.end(e),c.leave()},exports.listen=function(e,t){d.on(e,t),c.on(e,t),u.on(e,t),exports.on(e,t)},exports.reconnect=function(){c.start()},exports.connect=function(e){var t=e||{};if(t.jscode)l.setJsCode(t.jscode);if(t.authCode)l.setAuthCode(t.authCode);d.start(t)},exports.getData=function(e){return p.get(e)},exports.refreshCode=function(e){e.jsCode&&l.setJsCode(e.jsCode),e.authCode&&l.setAuthCode(e.authCode)},exports.getAuthCode=function(){u.getAuthCode()},exports.verifyCode=function(e){u.verifyCode(e)},exports.resetStartTime=function(){p.set("startTime",(new Date).getTime()),p.set("inited",1)},exports.lib=n,exports.init=function(e,n){if(a.isString(e))e={siteid:e};if(t(e,n),!n||!n.entered)c.start()},exports.hasConnented=function(){return d.hasConnented()},exports}),define("front/webimlite/base/json",["require","exports"],function(require,exports){function e(e){if(/["\\\x00-\x1f]/.test(e))e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=r[e];if(t)return t;else return t=e.charCodeAt(),"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)});return'"'+e+'"'}function t(e){var t,n,i,r=["["],a=e.length;for(n=0;a>n;n++)switch(i=e[n],typeof i){case"undefined":case"function":case"unknown":break;default:if(t)r.push(",");r.push(exports.stringify(i)),t=1}return r.push("]"),r.join("")}function n(e){return 10>e?"0"+e:e}function i(e){return'"'+e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+'"'}var r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};exports.parse=function(e){return new Function("return ("+e+")")()},exports.stringify=function(n){switch(typeof n){case"undefined":return"undefined";case"number":return isFinite(n)?String(n):"null";case"string":return e(n);case"boolean":return String(n);default:if(null===n)return"null";else if(n instanceof Array)return t(n);else if(n instanceof Date)return i(n);var r,a,o=["{"],s=exports.stringify;for(var u in n)if(Object.prototype.hasOwnProperty.call(n,u))switch(a=n[u],typeof a){case"undefined":case"unknown":case"function":break;default:if(r)o.push(",");r=1,o.push(s(u)+":"+s(a))}return o.push("}"),o.join("")}}}),define("front/webimlite/base/event",["require","exports","./dom"],function(require,exports){var e=require("./dom"),t=e.g;exports.EventArg=function(e,t){t=t||window,e=e||t.event;var n=t.document;this.target=e.target||e.srcElement,this.keyCode=e.which||e.keyCode;for(var i in e){var r=e[i];if("function"!=typeof r)this[i]=r}if(!this.pageX&&0!==this.pageX)this.pageX=(e.clientX||0)+(n.documentElement.scrollLeft||n.body.scrollLeft),this.pageY=(e.clientY||0)+(n.documentElement.scrollTop||n.body.scrollTop);this._event=e},exports.EventArg.prototype.preventDefault=function(){if(this._event.preventDefault)this._event.preventDefault();else this._event.returnValue=!1;return this},exports.EventArg.prototype.stopPropagation=function(){if(this._event.stopPropagation)this._event.stopPropagation();else this._event.cancelBubble=!0;return this},exports.EventArg.prototype.stop=function(){return this.stopPropagation().preventDefault()},exports._listeners=exports._listeners||[],exports.get=function(e,t){return new exports.EventArg(e,t)},exports.getTarget=function(e){return e.target||e.srcElement},exports.on=function(e,n,i){n=n.replace(/^on/i,""),e=t(e);var r,a=function(t){i.call(e,t)},o=exports._listeners,s=exports._eventFilter,u=n;if(n=n.toLowerCase(),s&&s[n])r=s[n](e,n,a),u=r.type,a=r.listener;if(e.addEventListener)e.addEventListener(u,a,!1);else if(e.attachEvent)e.attachEvent("on"+u,a);return o[o.length]=[e,n,i,a,u],e},exports.preventDefault=function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=!1},exports.stopPropagation=function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=!0},exports.un=function(e,n,i){e=t(e),n=n.replace(/^on/i,"").toLowerCase();for(var r,a,o,s=exports._listeners,u=s.length,l=!i;u--;)if(r=s[u],r[1]===n&&r[0]===e&&(l||r[2]===i)){if(a=r[4],o=r[3],e.removeEventListener)e.removeEventListener(a,o,!1);else if(e.detachEvent)e.detachEvent("on"+a,o);s.splice(u,1)}return e}}),define("front/webimlite/base/string",["require","exports"],function(require,exports){var e=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");exports.trim=function(t){return String(t).replace(e,"")},exports.encodeHTML=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},exports.decodeHTML=function(e){var t=String(e).replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");return t.replace(/&#([\d]+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},exports.escapeReg=function(e){return String(e).replace(new RegExp("([.*+?^=!:${}()|[\\]/\\\\])","g"),"\\$1")},exports.format=function(e,t){e=String(e);var n=Array.prototype.slice.call(arguments,1),i=Object.prototype.toString;if(n.length)return n=1===n.length?null!==t&&/\[object Array\]|\[object Object\]/.test(i.call(t))?t:n:n,e.replace(/#\{(.+?)\}/g,function(e,t){var r=n[t];if("[object Function]"===i.call(r))r=r(t);return"undefined"==typeof r?"":r});else return e}}),define("front/webimlite/base/browser",["require","exports"],function(require,exports){var e=navigator.userAgent;exports.firefox=/firefox\/(\d+\.\d+)/i.test(e)?+RegExp.$1:void 0,exports.ie=/msie (\d+\.\d+)|rv:11/i.test(e)?document.documentMode||+RegExp.$1:void 0,exports.isStrict="CSS1Compat"===document.compatMode,exports.isGecko=/gecko/i.test(e)&&!/like gecko/i.test(e),exports.isWebkit=/webkit/i.test(e),exports.opera=/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(e)?+(RegExp.$6||RegExp.$2):void 0,exports.chrome=/chrome/i.test(e),exports.safari=/Safari/i.test(e)&&/Version/i.test(e)}),define("front/webimlite/base/dom",["require","exports","./browser","./string"],function(require,exports){var e=require("./browser"),t=require("./string"),n=e.opera,i=e.ie,r={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};if(8>i)r["for"]="htmlFor",r["class"]="className";else r.htmlFor="for",r.className="class";exports.g=function(e){if("string"==typeof e)return document.getElementById(e);else return e},exports.q=function(e,n,i){var r,a,o,s,u=[],l=t.trim;if(!(e=l(e)))return u;if("undefined"==typeof n)n=document;else if(n=exports.g(n),!n)return u;if(i&&(i=l(i).toUpperCase()),n.getElementsByClassName)for(o=n.getElementsByClassName(e),r=o.length,a=0;r>a;a++)if(s=o[a],!i||s.tagName===i)u[u.length]=s;else;else for(e=new RegExp("(^|\\s)"+t.escapeReg(e)+"(\\s|$)"),o=i?n.getElementsByTagName(i):n.all||n.getElementsByTagName("*"),r=o.length,a=0;r>a;a++)s=o[a],e.test(s.className)&&(u[u.length]=s);return u},exports.setAttr=function(e,t,n){if(e=exports.g(e),"style"===t)e.style.cssText=n;else t=r[t]||t,e.setAttribute(t,n);return e},exports.setAttrs=function(e,t){var n;e=exports.g(e);for(n in t)if(t.hasOwnProperty(n))exports.setAttr(e,n,t[n]);return e},exports.create=function(e,t){var n=document.createElement(e);return exports.setAttrs(n,t||{})},exports.insertHTML=function(e,t,i){var r,a;if("string"==typeof e)e=document.getElementById(e);if(e.insertAdjacentHTML&&!n)e.insertAdjacentHTML(t,i);else{if(r=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"===t||"BEFOREEND"===t)r.selectNodeContents(e),r.collapse("AFTERBEGIN"===t);else a="BEFOREBEGIN"===t,r[a?"setStartBefore":"setEndAfter"](e),r.collapse(a);r.insertNode(r.createContextualFragment(i))}return e},exports.hasClass=function(e,n){if(e=exports.g(e),!e||!e.className)return!1;var i=t.trim(n).split(/\s+/),r=i.length;for(n=e.className.split(/\s+/).join(" ");r--;)if(!new RegExp("(^| )"+i[r]+"( |$)").test(n))return!1;
return!0},exports.addClass=function(e,t){e=exports.g(e);for(var n=t.split(/\s+/),i=e.className,r=" "+i+" ",a=0,o=n.length;o>a;a++)if(r.indexOf(" "+n[a]+" ")<0)i+=(i?" ":"")+n[a];return e.className=i,e},exports.removeClass=function(e,t){e=exports.g(e);for(var n,i,r=e.className.split(/\s+/),a=t.split(/\s+/),o=a.length,s=0;o>s;++s)for(i=0,n=r.length;n>i;++i)if(r[i]===a[s]){r.splice(i,1);break}return e.className=r.join(" "),e}}),define("front/webimlite/main",["require","./base/dom","./base/event","./base/json","qiao-im-core","./base/localstorage","../base/Promise","../common/identity","./base/browser","./base/string","./base/date","./base/object","./im/config","./im/lang","./im/editor"],function(require){function e(){var e,n,i,r=1===G.position?"left:0px;right:auto;":"";if(z.container=O("div",{id:"BD_QIAO_WEBIM_LITE_WRAP",className:"BD-QIAO-WEBIM-LITE-WRAP",style:"display:none;"+r}),z.title=O("div",{className:"m-lite-title"}),G.bgColor)z.title.style.cssText="background-color:"+G.bgColor;for(z.title.innerHTML=X.title,z.container.appendChild(z.title),e=z.title.getElementsByTagName("a"),n=0;i=e[n];n++)if(i.className.indexOf("btn-min")>=0)z.minBtn=i;else if(i.className.indexOf("btn-max")>=0)z.maxBtn=i;if(z.content=O("div",{className:"m-lite-content"}),z.container.appendChild(z.content),z.tip=O("div",{className:"m-lite-tip"}),z.container.appendChild(z.tip),z.editor=O("div",{className:"m-lite-editor"}),z.container.appendChild(z.editor),z.opt=O("a",{className:"m-lite-opt",target:"_blank",href:"http://qiao.baidu.com/home/"}),z.opt.innerHTML=X.opt,z.container.appendChild(z.opt),z.widgets=[z.content,z.editor,z.opt,z.tip],N.ie<=6)z.iframe=O("iframe",{src:"about:blank",scrolling:"no",frameborder:0,style:"width:100%;z-index:-1;position:absolute;top:0;left:0;"}),z.container.appendChild(z.iframe),z.container.style.position="absolute",window.attachEvent("onscroll",t),window.attachEvent("onresize",t);document.body.appendChild(z.container),V.init(z.editor,G)}function t(){var e=N.isStrict?document.documentElement:document.body,t=z.container;t.style.top=e.clientHeight+e.scrollTop-t.clientHeight+"px"}function n(e){e.scrollTop+=e.scrollHeight}function i(){var e=/(^|\s+)btn-([^-]+)(\s+|$)/;z.container.onclick=function(t){var n;t=t||window.event,n=t.target||t.srcElement;var i=n.tagName.toLowerCase();if("i"===i)n=n.parentNode,i=n.tagName.toLowerCase();if("a"===i&&n.className.indexOf("btn")>=0)n.className.replace(e,function(e,t,i,r){var a;if(a=J[i])a.call(null,n)}),H(t);else if("span"===i&&n.className.indexOf("m-lite-title-notify-text")>=0)h("all");else if(n.className.indexOf("m-send-method-btn")>=0){if(w.hasClass(w.q("m-send-method-btn")[0],"arrow"))return w.q("m-send-method")[0].style.display="none",void w.removeClass(w.q("m-send-method-btn")[0],"arrow");w.q("m-send-method")[0].style.display="block",w.addClass(w.q("m-send-method-btn")[0],"arrow")}a(!1)},V.on("focus",function(){a(!1)}),T.listen("init",function(){Y.jscode=B.jscode.jscode,T.connect(Y)}),T.listen("message",function(e,t,n,i){for(var r,o=e.length,s=0;o>s;s++){if(r=e[s],r.type="server",K.messages.push(r),r.time=new Date,""===t)t="我",r.type="client";if("history"===i)r.time=new Date(parseInt(n,10));r.csName=t,c(r)}if("none"===K.showType)h("min");a(!0)}),T.listen("connect",function(){K.status=1,K.sendAbled=!0,exports.emit("ready");var e=document.getElementById("BD_QIAO_WEBIM_LITE_WRAP");if(M("m-lite-msg-info-inner",e)[0].innerHTML="转接成功",y)g(y)}),T.listen("info",function(e){c({text:e,type:"info"})}),T.listen("inputing",function(){o('<i class="inputing"></i><span>对方正在输入...</span>')}),T.listen("sendpreview",function(e){var t=V.getContent();if(t=P(t))t=f(t,V.isMultilineMode()),e&e(t)}),T.listen("authCode",function(e){exports.auth(function(e){Y.authCode=e.code,Y.jscode=B.jscode.jscode,T.connect(Y)},e.tag)}),T.listen("secondConfirm",function(){}),T.listen("error",function(e){switch(e){case W.CONNECT:var t=document.getElementById("BD_QIAO_WEBIM_LITE_WRAP");M("m-lite-msg-info-inner",t)[0].innerHTML="转接失败"}}),T.listen("stop",function(){c({text:U.ERROR.DROP_KICKED,type:"info"}),K.sendAbled=!1,M("m-lite-btn",z.editor)[0].className+=" m-lite-opt-unablebtn"}),T.listen("transfer",function(){c({text:U.TEXT.TRANSFER,type:"info"})}),V.on("exporthistory",u),V.on("editorsend",J.send),Z=!0}function r(e){if(K.flashTimer)clearTimeout(K.flashTimer),K.flashTimer=null;e%=Q.flashTitle.length,document.title=Q.flashTitle[e]+K.pageTitle,K.flashTimer=setTimeout(function(){r(++e)},500)}function a(e){if(e&&z.title.className.indexOf("notify")<0)z.title.className+=" m-lite-title-notify",K.pageTitle=document.title,r(0);else if(!e&&z.title.className.indexOf("notify")>=0)z.title.className=z.title.className.replace(/\s+m-lite-title-notify/g,""),clearTimeout(K.flashTimer),K.flashTimer=null,document.title=K.pageTitle||document.title}function o(e){if(K.tiptimer)clearTimeout(K.tiptimer);if("all"===K.showType)z.tip.innerHTML=e,K.tiptimer=setTimeout(function(){z.tip.innerHTML="&nbsp;&nbsp;"},3e3)}function s(){if(K.tiptimer)clearTimeout(K.tiptimer);z.tip.innerHTML="&nbsp;&nbsp;"}function u(){var e,t,n,i,r,a=L("BD_Qiao_History");if(!a)a=O("form",{id:"BD_Qiao_History",method:"post",target:"_blank"}),a.setAttribute("accept-charset","utf-8"),a.setAttribute("action",G.root+"download_record.php"),a.style.display="none",a.innerHTML=X.history,document.body.appendChild(a);for(e=a.getElementsByTagName("input"),n=0,i=e.length;i>n;n++)switch(t=e[n],t.name){case"r":t.value=z.content.innerHTML.replace(/\r\n|\n/g,"<br>").replace(/<table.*?zoom_table.*?>.*?<\/table>/gi,"(图片)");break;case"t":t.value=G.userGroupName||"";break;case"z":if(N.ie)t.value=!0;else t.value=!1;break;case"prefix":t.value=G.root}if(N.ie)return r=document.charset,document.charset="utf-8",a.submit(),void(document.charset=r);else return void a.submit()}function l(e){if(e.text)e.text=e.text.replace(/simsun/,"Microsoft Yahei").replace(/10pt/,"9pt");return e}function c(e){var t;switch(e.type){case"connInfo":t=X.connInfo;break;case"info":t=X.info;break;default:t=X.msg}var i;if(e=l(e),e=A({},e),e.time=F(e.time),D(z.content,"beforeend",j(t,e)),e=e.style){t="";for(i in e)if(e.hasOwnProperty(i)){var r=i.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()});t+=r+":"+e[i]+";"}z.content.lastChild.children[1].style.cssText=t}n(z.content)}function d(){if(!z.container)e(),!Z&&i(),I.done(),T.init({bid:G.bid,peerid:G.peerid,siteid:G.siteid,ucid:G.ucid,mainid:G.mainid,username:G.userName,csNameType:G.csNameType,nickname:G.customName,vis_type:3,clienttype:3,startTime:(new Date).getTime(),type:0},{crossdomain:!0,entered:!0})}function f(e,t){if(t)if(N.ie)e=e.replace(/(^<P>|<\/P>$)/gi,"").replace(/<\/P>\s*<P>/gi,"<br>").replace(/\&nbsp;?/g," ");else if(N.firefox)e=e.replace(/<br>$/," ");else if(N.opera)e=e.replace(/<br>/gi," ").replace(/(^<p>|<\/p>$)/gi,"").replace(/<\/p><p>/gi,"<br>");else e=e.replace(/<div>/i,"<BR>").replace(/<\/div>$/i,"").replace(/<\/div><div>/gi,"<BR>").replace(/<br>/g," "),e=e.replace(/<BR>/g,"<br>");else e=e.replace(/<BR>/g,"<br>");for(var n=[];/((<br[^>]*\/?>)|(<img[^>]+>))/im.test(e);)n[n.length]=RegExp.$1,e=e.replace(RegExp.$1,""+(n.length-1)+"");e=e.replace(/<[^>]+>/gm,"");for(var i=0;i<e.length;i++)e=e.replace(""+i+"",n[i]);return e=e.replace(/(<br[^>]*\/?>)/gim,"\n"),e=e.replace(/&nbsp;/g," ")}function p(e){if(!e)return"";else return(e+"").replace(/\&([^;]+);/g,function(e,t){var n;if(t in ee)return ee[t];else if(n=t.match(/^#x([\da-fA-F]+)$/))return String.fromCharCode(parseInt(n[1],16));else if(n=t.match(/^#(\d+)$/))return String.fromCharCode(parseInt(n[1],10));return e})}function m(){return A({},G.searchInfo)}function h(e){var i,r;if(z.container)if("none"===e)z.container.style.display="none",K.showType="none";else{for(z.container.style.display="",z.title.style.display="",i=0;r=z.widgets[i];i++)r.style.display="all"===e?"":"none";if(z.minBtn.style.display="all"===e?"":"none",z.maxBtn.style.display="all"===e?"none":"",K.showType="all"===e?"all":"min","all"===e)n(z.content);else s();if(N.ie<=6)z.iframe.style.height=z.container.clientHeight-2+"px",setTimeout(function(){t()},0)}}function g(e){var t,n=V.getStyle();if(e=P(e)){e=f(e,V.isMultilineMode()),t={text:e,csName:"我",type:"client",style:n},t.time=new Date;var i=A({type:"text",text:p(e)},n);T.send(i),c(t),K.messages.push(t),V.clear()}}function v(){return $.PRE+G.siteid+"_IM"}function b(){var e=E.getItem(v());if(e){e=q(e);var t=e.lasttime;if((new Date).getTime()-t<12e4)exports.emit("revertsession")}}var y,w=require("./base/dom"),x=require("./base/event"),_=require("./base/json"),T=require("qiao-im-core"),E=require("./base/localstorage"),S=T.lib.mixin,C=require("../base/Promise"),I=(require("../common/identity"),new C),L=w.g,M=w.q,N=(x.on,require("./base/browser")),k=require("./base/string"),R=require("./base/date"),D=w.insertHTML,O=w.create,A=require("./base/object").extend,P=(_.stringify,k.trim),j=k.format,F=(k.encodeHTML,R.dataFormat),q=_.parse,H=x.preventDefault,B=require("./im/config"),U=require("./im/lang"),Y={},V=require("./im/editor"),W={CONNECT:"connect"},$={PRE:"BDBG_IM_",LAST_CHAT_TIME:"lasttime"},exports={};S(exports);var G={},z={},K={messages:[],status:0,showType:"none",sendAbled:!1,showOnce:!0,firstEnterFlag:!1},J={},X={title:'<a href="#" class="m-lite-title-btn btn-max"><i></i></a><a href="#" class="m-lite-title-btn btn-min"><i></i></a><span class="m-lite-title-text">在线咨询</span><span class="m-lite-title-notify-text"><em></em>您有未读消息</span>',msg:'<div class="m-lite-msg msg-#{type}"><div class="m-lite-msg-title"><span class="m-lite-msg-name">#{csName}</span>#{time}</div><div class="m-lite-msg-content">#{text}</div><div class="m-lite-msg-cursor"></div>',info:'<div class="m-lite-msg-info m-lite-connect-info"><div class="m-lite-msg-info-inner">#{text}</div></div>',opt:'<span class="m-lite-logo"></span><span class="m-lite-qiao">咨询软件由百度商桥免费提供</span>',history:'<input type="hidden" name="r" value="" /><input type="hidden" name="t" value="" /><input type="hidden" name="z" value="" /><input type="hidden" name="prefix" value="" />',titleBgColor:"border-color:#{color};background-image:none;background: -webkit-gradient(linear, left top, left bottom, from(#fdfeff), to(#{color}));background: -webkit-linear-gradient(top, #fdfeff, #{color});background:-moz-linear-gradient(top, #fdfeff, #{color});background:-o-linear-gradient(top, #fdfeff, #{color});background:linear-gradient(top bottom, #fdfeff, #{color});",connInfo:'<div class="m-lite-msg-info m-lite-connect-info"><div class="m-lite-msg-info-inner">#{text}</div></div>'},Q={flashTitle:["【新消息】","【　　　】"]},Z=!1,ee={amp:"&",lt:"<",gt:">",quot:'"',apos:"'"};return J.close=function(){h("none")},J.max=function(e){h("all")},J.min=function(e){h("min")},J.send=function(){var e=V.getContent();if(K.sendAbled)g(e)},exports.init=function(e){if(G.bid=e.bid,G.peerid=e.peerid,G.siteid=e.siteid,G.ucid=e.ucid,G.mainid=e.mainid,G.SITE_ID=e.SITE_ID,G.userName=e.userName,G.offsetTime=parseInt(e.offsetTime,10),G.root=e.root||"//hqiao.baidu.com/v3/",G.bgColor=e.bgColor||"#2c77ff",G.position=e.position,G.csNameType=e.csNameType,G.customName=e.customName,G.searchInfo=e.searchInfo,G.jscode=e.jscode,G.IMroot=e.imRoot,G.authCode=e.authCode,G.poolRoot=e.POOL_ROOT,isNaN(G.offsetTime))G.offsetTime=0;B.init(G);var t={};if(t.siteid=G.siteid,G.jscode)B.jscode.jscode=G.jscode;B.authCode=G.authCode,B.URL.HI_SERVER=G.IMroot,K.firstEnterFlag=!1,E.init(),b()},exports.refreshCode=function(e){T.refreshCode(e)},exports.auth=function(e,t){exports.emit("auth",e,t)},exports.accept=function(e){if(!T.hasConnented()){if(e.userGroupName)G.userGroupName=e.userGroupName,delete e.userGroupName;e=A(m(),e),Y={subid:e.subid,groupid:e.bridgeTid,chattype:e.chattype},y=e.chat,d(Y),c({text:"正在连接...",type:"connInfo"}),I.promise().then(function(){Y.jscode=B.jscode.jscode,T.connect(Y)})}return h("all"),!0},exports.show=function(){h("all")},exports});

})(qiao.define, qiao.require);